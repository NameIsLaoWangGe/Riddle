{
  "code": "import { lwg } from \"../Lwg_Template/lwg\";\r\nexport default class UIMain_Person extends Laya.Script {\r\n    constructor() {\r\n        super();\r\n        this.floor_01Switch = false;\r\n        this.floor_02Switch = false;\r\n        this.ladder_01Switch = false;\r\n        this.ladder_02Switch = false;\r\n        this.beforeLadderDir = lwg.Enum.PersonDir.left;\r\n        this.targetP = new Laya.Point();\r\n        this._belongX = null;\r\n        this._belongY = null;\r\n        this._belongChange = false;\r\n    }\r\n    onEnable() {\r\n        this.self = this.owner;\r\n        this.selfScene = this.self.scene;\r\n        this.belongRoom = this.selfScene.getChildByName('Room2');\r\n        this.moveDirection = lwg.Enum.PersonDir.right;\r\n        this.self['UIMain_Person'] = this;\r\n        this.rig = this.self.getComponent(Laya.RigidBody);\r\n    }\r\n    changeRoom(roomName) {\r\n        this.self.visible = false;\r\n        this.belongRoom = this.selfScene.getChildByName(roomName);\r\n        this.self.visible = true;\r\n    }\r\n    onTriggerEnter(other, self) {\r\n        if (!lwg.Global._gameStart) {\r\n            return;\r\n        }\r\n        let otherOwner = other.owner;\r\n        let otherName = otherOwner.name;\r\n        switch (other.label) {\r\n            case 'wall':\r\n                this.changeDirection();\r\n                break;\r\n            case 'floor':\r\n                if (otherOwner.name === lwg.Enum.FloorType.Floor_01 + '_' + this.belongRoom.name) {\r\n                    this.floor_01Switch = true;\r\n                    this.ladder_01Switch = false;\r\n                    this.upDwonChangeLeftRight();\r\n                    console.log(other.owner.name + '连接');\r\n                }\r\n                else if (otherOwner.name === lwg.Enum.FloorType.Floor_02 + '_' + this.belongRoom.name) {\r\n                    this.floor_02Switch = true;\r\n                    this.ladder_02Switch = false;\r\n                    this.upDwonChangeLeftRight();\r\n                    console.log(other.owner.name + '连接');\r\n                }\r\n                break;\r\n            case 'ladder':\r\n                if (this.moveDirection === lwg.Enum.PersonDir.left || this.moveDirection === lwg.Enum.PersonDir.right) {\r\n                    this.beforeLadderDir = this.moveDirection;\r\n                }\r\n                console.log('碰到梯子了！');\r\n                let otherNamelen = otherOwner.name.length;\r\n                let num = otherOwner.name.substring(otherNamelen - 2, otherNamelen);\r\n                let aisleName = 'up_Aisle_' + num;\r\n                let upAisle = this.belongRoom.getChildByName(aisleName);\r\n                if (!upAisle) {\r\n                    return;\r\n                }\r\n                let upOpenSwitch = upAisle['UIMain_Aisle'].openSwitch;\r\n                if (upOpenSwitch) {\r\n                    let y1 = this.self.y;\r\n                    let y2 = otherOwner.y + otherOwner.parent.y - otherOwner.parent.height / 2;\r\n                    if (y1 > y2) {\r\n                        this.moveDirection = lwg.Enum.PersonDir.down;\r\n                    }\r\n                    else {\r\n                        this.moveDirection = lwg.Enum.PersonDir.up;\r\n                    }\r\n                    if (otherOwner.name === lwg.Enum.OtherType.ladder_01) {\r\n                        this.floor_01Switch = false;\r\n                        this.ladder_01Switch = true;\r\n                        console.log(other.owner.name + '连接');\r\n                    }\r\n                    else if (otherOwner.name === lwg.Enum.OtherType.ladder_02) {\r\n                        this.floor_02Switch = false;\r\n                        this.ladder_02Switch = true;\r\n                        console.log(other.owner.name + '连接');\r\n                    }\r\n                }\r\n                else {\r\n                    console.log('通道未打开，不会上梯子！');\r\n                }\r\n                break;\r\n            case 'aisle':\r\n                let openSwitch = otherOwner['UIMain_Aisle'].openSwitch;\r\n                let connectRoom = otherOwner['UIMain_Aisle'].connectRoom;\r\n                let otherDir = otherName.substring(0, 1);\r\n                let selfDir = this.moveDirection.substring(0, 1);\r\n                console.log(otherDir);\r\n                console.log(selfDir);\r\n                if (openSwitch === false) {\r\n                    if (selfDir === 'l' || selfDir === 'r') {\r\n                        if (otherDir === 'u' || otherDir === 'd') {\r\n                            return;\r\n                        }\r\n                        else {\r\n                            this.changeDirection();\r\n                        }\r\n                    }\r\n                    else if (selfDir === 'u' || selfDir === 'd') {\r\n                        if (otherDir === 'l' || otherDir === 'r') {\r\n                            return;\r\n                        }\r\n                        else {\r\n                            this.changeDirection();\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    if (otherDir === selfDir) {\r\n                        if (this.belongRoom !== connectRoom) {\r\n                            this.belongRoom = connectRoom;\r\n                            this._belongChange = true;\r\n                        }\r\n                    }\r\n                    else if ((otherDir === 'd' && selfDir === 'l') || (otherDir === 'd' && selfDir === 'r')) {\r\n                        console.log('下行');\r\n                        if (this.belongRoom !== connectRoom) {\r\n                            this.belongRoom = connectRoom;\r\n                            this._belongChange = true;\r\n                            this.moveDirection = lwg.Enum.PersonDir.down;\r\n                            this.ladder_01Switch = false;\r\n                            this.ladder_02Switch = false;\r\n                        }\r\n                    }\r\n                    else if (selfDir === 'u' && otherDir === 'd') {\r\n                        console.log('啥也不做！');\r\n                    }\r\n                }\r\n                break;\r\n            case 'target':\r\n                lwg.Global._gameStart = false;\r\n                this.targetP.x = otherOwner.x;\r\n                this.targetP.y = otherOwner.y;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    upDwonChangeLeftRight() {\r\n        if (this.moveDirection === lwg.Enum.PersonDir.down || this.moveDirection === lwg.Enum.PersonDir.up) {\r\n            if (this.beforeLadderDir) {\r\n                this.moveDirection = this.beforeLadderDir;\r\n            }\r\n        }\r\n    }\r\n    onTriggerStay(other, self) { }\r\n    onTriggerExit(other, self) {\r\n        if (!lwg.Global._gameStart) {\r\n            return;\r\n        }\r\n        if (other.owner.name === lwg.Enum.FloorType.Floor_01 + '_' + this.belongRoom.name) {\r\n            this.floor_01Switch = false;\r\n            console.log(other.owner.name + '退出');\r\n        }\r\n        if (other.owner.name === lwg.Enum.FloorType.Floor_02 + '_' + this.belongRoom.name) {\r\n            this.floor_02Switch = false;\r\n            console.log(other.owner.name + '退出');\r\n        }\r\n        if (other.owner.name === lwg.Enum.OtherType.ladder_01) {\r\n            this.ladder_01Switch = false;\r\n            console.log(other.owner.name + '退出');\r\n        }\r\n        if (other.owner.name === lwg.Enum.OtherType.ladder_01) {\r\n            this.ladder_02Switch = false;\r\n            console.log(other.owner.name + '退出');\r\n        }\r\n    }\r\n    changeDirection() {\r\n        if (this.moveDirection === lwg.Enum.PersonDir.left) {\r\n            this.moveDirection = lwg.Enum.PersonDir.right;\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.right) {\r\n            this.moveDirection = lwg.Enum.PersonDir.left;\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.up) {\r\n            this.moveDirection = lwg.Enum.PersonDir.down;\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.down) {\r\n            this.moveDirection = lwg.Enum.PersonDir.up;\r\n        }\r\n    }\r\n    move() {\r\n        if (this.moveDirection === lwg.Enum.PersonDir.left) {\r\n            this.rig.setVelocity({ x: -3, y: 0 });\r\n            let pic = this.self.getChildByName('pic');\r\n            pic.scaleX = -1;\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.right) {\r\n            this.rig.setVelocity({ x: 3, y: 0 });\r\n            let pic = this.self.getChildByName('pic');\r\n            pic.scaleX = 1;\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.up) {\r\n            this.rig.setVelocity({ x: 0, y: -3 });\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.down) {\r\n            this.rig.setVelocity({ x: 0, y: 3 });\r\n        }\r\n        if (this.moveDirection === lwg.Enum.PersonDir.left || this.moveDirection === lwg.Enum.PersonDir.right) {\r\n            if (!this._belongX) {\r\n                if (this.belongRoom) {\r\n                    this._belongX = this.belongRoom.x;\r\n                }\r\n            }\r\n            else {\r\n                if (this._belongChange) {\r\n                    this._belongX = null;\r\n                    this._belongChange = false;\r\n                }\r\n                else {\r\n                    let x = this.belongRoom.x - this._belongX;\r\n                    this.self.x = this.self.x + x;\r\n                    this._belongX = this.belongRoom.x;\r\n                }\r\n            }\r\n        }\r\n        if (this.moveDirection === lwg.Enum.PersonDir.down || this.moveDirection === lwg.Enum.PersonDir.up) {\r\n            if (!this._belongY) {\r\n                if (this.belongRoom) {\r\n                    this._belongY = this.belongRoom.y;\r\n                }\r\n            }\r\n            else {\r\n                if (this._belongChange) {\r\n                    this._belongY = null;\r\n                    this._belongChange = false;\r\n                }\r\n                else {\r\n                    let y = this.belongRoom.y - this._belongY;\r\n                    this.self.y = this.self.y + y;\r\n                    this._belongY = this.belongRoom.y;\r\n                }\r\n            }\r\n        }\r\n        if (this.belongRoom) {\r\n            let floor_01 = this.belongRoom['UIMain_Room'].Floor_01;\r\n            let floor_02 = this.belongRoom['UIMain_Room'].Floor_02;\r\n            if (floor_01 && this.floor_01Switch) {\r\n                let y = floor_01.y + this.belongRoom.y - this.belongRoom.height / 2;\r\n                this.self.y = y - 20;\r\n            }\r\n            else if (floor_02 && this.floor_02Switch) {\r\n                let y = floor_02.y + this.belongRoom.y - this.belongRoom.height / 2;\r\n                this.self.y = y - 20;\r\n            }\r\n        }\r\n    }\r\n    followPerson() {\r\n        if (this.targetP) {\r\n            let x = this.targetP.x + this.belongRoom.x - this.belongRoom.width / 2;\r\n            let y = this.targetP.y + this.belongRoom.y - this.belongRoom.height / 2;\r\n            this.self.x = x - 50;\r\n            this.self.y = y + 10;\r\n        }\r\n    }\r\n    onUpdate() {\r\n        if (!lwg.Global._gameStart) {\r\n            this.rig.setVelocity({ x: 0, y: 0 });\r\n            this.followPerson();\r\n            return;\r\n        }\r\n        this.move();\r\n    }\r\n    onDisable() {\r\n    }\r\n}\r\n",
  "references": [
    "D:/Game/project/Riddle/Riddle/src/script/Lwg_Template/lwg.ts"
  ]
}
