{
  "code": "import RotateSelfPro from \"./RotateSelfPro\";\r\nimport { lwg } from \"../script/Lwg_Template/lwg\";\r\nimport ADManager, { TaT } from \"../TJ/Admanager\";\r\nexport default class ZhuanPan extends Laya.Script {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.lotteryProps = [];\r\n        this.firstUseed = \"1\";\r\n        this.lotteryGift = LotteryGift.prop1;\r\n        this.lotteryNum = 0;\r\n        this.lotteryindex = 0;\r\n        this.mouseDwon = false;\r\n        this.mouseMove = false;\r\n    }\r\n    onAwake() {\r\n        ADManager.CloseBanner();\r\n        ADManager.TAPoint(TaT.BtnShow, 'ADrewardbt_turn');\r\n        lwg.Global._stageClick = false;\r\n        this.Zhuanpan = this.owner;\r\n        this.zhuanpanParent = this.Zhuanpan.getChildByName(\"zhuanpanParent\");\r\n        this.RewardPanel = this.Zhuanpan.getChildByName(\"RewardPanel\");\r\n        this.StartBtn = this.Zhuanpan.getChildByName(\"StartBtn\");\r\n        this.ZhuanpanBG = this.zhuanpanParent.getChildByName(\"ZhunpanBG\");\r\n        this.ZhuanpanZhizhen = this.zhuanpanParent.getChildByName(\"ZhiZhen\");\r\n        this.BG = this.ZhuanpanBG.getChildByName(\"BG\");\r\n        for (let index = 0; index < this.BG.numChildren; index++) {\r\n            this.lotteryProps.push(this.BG.getChildByName('prop' + (index + 1)));\r\n        }\r\n        this.RewardPanelInit();\r\n        this._rotateSelfPro = this.zhuanpanParent.getComponent(RotateSelfPro);\r\n        this._rotateSelfPro.OpenZhiZhen();\r\n        this.StartBtn.on(Laya.Event.CLICK, this, this.ZhunapanStart);\r\n        this.CaiDanMoveInit();\r\n        this.First = this.StartBtn.getChildByName(\"First\");\r\n        this.Second = this.StartBtn.getChildByName(\"Second\");\r\n        this.RefreshBtn();\r\n        lwg.Click.on(lwg.Click.ClickType.largen, null, this.owner.scene['BtnBack'], this, null, null, this.btnCloseUp, null);\r\n    }\r\n    btnCloseUp(e) {\r\n        e.currentTarget.scale(1, 1);\r\n        this.owner.scene.close();\r\n    }\r\n    RefreshBtn() {\r\n        this.firstUseed = Laya.LocalStorage.getItem(\"firstUseed\");\r\n        if (this.firstUseed) {\r\n            if (this.firstUseed == \"0\") {\r\n                this.First.visible = true;\r\n                this.Second.visible = false;\r\n            }\r\n            else {\r\n                this.First.visible = false;\r\n                this.Second.visible = true;\r\n            }\r\n        }\r\n        else {\r\n            this.First.visible = true;\r\n            this.Second.visible = false;\r\n            Laya.LocalStorage.setItem(\"firstUseed\", \"0\");\r\n        }\r\n    }\r\n    ZhunapanStart() {\r\n        ADManager.TAPoint(TaT.BtnClick, 'ADrewardbt_turn');\r\n        console.log(\"点击转盘\");\r\n        if (this.First.visible) {\r\n            Laya.LocalStorage.setItem(\"firstUseed\", \"1\");\r\n            this.StartLottery();\r\n            this.StartBtn.visible = false;\r\n        }\r\n        else {\r\n            ADManager.ShowReward(() => {\r\n                this.StartLottery();\r\n                this.StartBtn.visible = false;\r\n            });\r\n        }\r\n    }\r\n    StartLottery() {\r\n        this._rotateSelfPro.AddSpeed();\r\n        this._rotateSelfPro.OpenZhiZhen();\r\n        Laya.timer.once(1500, this, this.StopLottery);\r\n    }\r\n    StopLottery() {\r\n        this.lotteryNum++;\r\n        console.log(\"转盘停止\");\r\n        let ran = this.randomInRange_i(0, 100);\r\n        if (ran >= 0 && ran < 20) {\r\n            this.lotteryGift = 0;\r\n        }\r\n        else if (ran >= 20 && ran < 40) {\r\n            if (lwg.Global._zibiyazi || this.lotteryNum === 1) {\r\n                this.lotteryGift = 2;\r\n            }\r\n            else {\r\n                this.lotteryGift = 1;\r\n                lwg.Global._zibiyazi = true;\r\n            }\r\n        }\r\n        else if (ran >= 40 && ran < 60) {\r\n            this.lotteryGift = 2;\r\n        }\r\n        else if (ran >= 60 && ran < 80) {\r\n            this.lotteryGift = 3;\r\n        }\r\n        else if (ran >= 80 && ran < 100) {\r\n            this.lotteryGift = 5;\r\n        }\r\n        let degree = 60 * this.lotteryGift + this.randomInRange_i(25, 35);\r\n        this._rotateSelfPro.StopSpeed(degree, () => {\r\n            this.lotteryindex = this.lotteryGift;\r\n            switch (this.lotteryGift) {\r\n                case 0:\r\n                    lwg.Global._addExecution(3);\r\n                    break;\r\n                case 1:\r\n                    lwg.Global._paintedPifu.push[RewardDec.prop2];\r\n                    lwg.Global._createHint_01(lwg.Enum.HintType.zibiyazi);\r\n                    break;\r\n                case 2:\r\n                    lwg.Global._addGold(30);\r\n                    break;\r\n                case 3:\r\n                    lwg.Global._addExecution(2);\r\n                    break;\r\n                case 4:\r\n                    break;\r\n                case 5:\r\n                    lwg.Global._addGold(60);\r\n                    break;\r\n            }\r\n            console.log(\"获取礼物\", this.lotteryGift + 1);\r\n            Laya.timer.once(500, this, this.ShowReward);\r\n        });\r\n    }\r\n    RewardPanelInit() {\r\n        let BtnADAgain = this.RewardPanel.getChildByName(\"BtnADAgain\");\r\n        let BtnNo = this.RewardPanel.getChildByName(\"BtnNo\");\r\n        console.log(BtnNo);\r\n        lwg.Click.on(lwg.Click.ClickType.largen, null, BtnADAgain, this, null, null, this.btnADAgainUp, null);\r\n        lwg.Click.on(lwg.Click.ClickType.largen, null, BtnNo, this, null, null, this.btnNoUp, null);\r\n    }\r\n    btnADAgainUp() {\r\n        ADManager.TAPoint(TaT.BtnClick, 'ADrewardbt_turngift');\r\n        ADManager.ShowReward(() => {\r\n            this.ClosePanel();\r\n            this.StartLottery();\r\n            this.StartBtn.visible = false;\r\n        });\r\n    }\r\n    btnNoUp(e) {\r\n        this.ClosePanel();\r\n    }\r\n    ShowReward() {\r\n        ADManager.TAPoint(TaT.PageEnter, 'turngiftpage');\r\n        ADManager.TAPoint(TaT.BtnShow, 'ADrewardbt_turngift');\r\n        this.RewardPanel.x = 0;\r\n        this.RewardPanel.y = 0;\r\n        this.RefreshBtn();\r\n        this.StartBtn.visible = true;\r\n        let prop = this.RewardPanel.getChildByName('Prop');\r\n        let pic = prop.getChildByName('Pic');\r\n        pic.skin = RewardSkin['prop' + (this.lotteryindex + 1)];\r\n        let dec = prop.getChildByName('Dec');\r\n        dec.text = RewardDec['prop' + (this.lotteryindex + 1)];\r\n        if (this.lotteryindex + 1 === 2 || this.lotteryindex + 1 === 5) {\r\n            pic.scale(0.5, 0.5);\r\n            pic.x = -35;\r\n            pic.y = -53;\r\n        }\r\n        else {\r\n            if (this.lotteryindex + 1 === 1 || this.lotteryindex + 1 === 4) {\r\n                pic.x = 12.5;\r\n                pic.y = 26;\r\n            }\r\n            else if (this.lotteryindex + 1 === 3 || this.lotteryindex + 1 === 6) {\r\n                pic.x = 12.5;\r\n                pic.y = 26;\r\n            }\r\n            pic.scale(1, 1);\r\n        }\r\n    }\r\n    ClosePanel() {\r\n        ADManager.TAPoint(TaT.PageLeave, 'turngiftpage');\r\n        this.RewardPanel.x = 1500;\r\n        this.RewardPanel.y = 0;\r\n    }\r\n    CaiDanMoveInit() {\r\n        lwg.Click.on(lwg.Click.ClickType.noEffect, null, this.owner.scene['Caidan'], this, this.caidanDwon, null, null, null);\r\n        let BtnNo = this.owner.scene['Painted_Pikaqiu'].getChildByName('BtnNo');\r\n        let BtnFreeGet = this.owner.scene['Painted_Pikaqiu'].getChildByName('BtnFreeGet');\r\n        ADManager.TAPoint(TaT.BtnShow, 'ADrewardbt_dragongift');\r\n        lwg.Click.on(lwg.Click.ClickType.largen, null, BtnNo, this, null, null, this.btnNoUp_P, null);\r\n        lwg.Click.on(lwg.Click.ClickType.largen, null, BtnFreeGet, this, null, null, this.btnFreeGetUp_P, null);\r\n    }\r\n    btnNoUp_P(e) {\r\n        ADManager.TAPoint(TaT.PageLeave, 'PKskinQpage');\r\n        ADManager.TAPoint(TaT.BtnShow, 'ADrewardbt_PKskin');\r\n        e.currentTarget.scale(1, 1);\r\n        this.owner.scene['Painted_Pikaqiu'].x = 1500;\r\n        this.owner.scene['Painted_Pikaqiu'].y = 0;\r\n    }\r\n    btnFreeGetUp_P(e) {\r\n        ADManager.TAPoint(TaT.BtnClick, 'ADrewardbt_PKskin');\r\n        e.currentTarget.scale(1, 1);\r\n        ADManager.ShowReward(() => {\r\n            lwg.Global._huangpihaozi = true;\r\n            lwg.LocalStorage.addData();\r\n            this.owner.scene['Painted_Pikaqiu'].x = 1500;\r\n            this.owner.scene['Painted_Pikaqiu'].y = 0;\r\n            lwg.Global._paintedPifu.push[RewardDec.prop5];\r\n            lwg.Global._createHint_01(lwg.Enum.HintType.huangpihaozi);\r\n        });\r\n    }\r\n    caidanDwon() {\r\n        if (!lwg.Global._huangpihaozi) {\r\n            this.mouseDwon = true;\r\n        }\r\n        else {\r\n            console.log('已经获得了黄皮耗子皮肤！');\r\n        }\r\n    }\r\n    onStageMouseMove(e) {\r\n        if (this.mouseDwon) {\r\n            this.mouseMove = true;\r\n            this.owner.scene.addChild(this.owner.scene['Caidan']);\r\n            this.owner.scene['Caidan'].x = e.stageX;\r\n            this.owner.scene['Caidan'].y = e.stageY;\r\n        }\r\n    }\r\n    onStageMouseUp(e) {\r\n        if (this.mouseMove) {\r\n            this.owner.scene['CaidanParent'].addChild(this.owner.scene['Caidan']);\r\n            this.owner.scene['Caidan'].x = 472;\r\n            this.owner.scene['Caidan'].y = 301;\r\n            this.mouseDwon = false;\r\n            this.mouseMove = false;\r\n            let point = new Laya.Point(e.stageX, e.stageY);\r\n            let dis = point.distance(this.owner.scene['ZhunpanBG'].x, this.owner.scene['ZhunpanBG'].y);\r\n            if (dis - this.owner.scene['ZhunpanBG'].width / 2 > 0) {\r\n                ADManager.TAPoint(TaT.PageEnter, 'PKskinQpage');\r\n                this.owner.scene['Painted_Pikaqiu'].x = 0;\r\n                this.owner.scene['Painted_Pikaqiu'].y = 0;\r\n            }\r\n        }\r\n    }\r\n    randomInRange_i(x, y, s = null) {\r\n        let rs;\r\n        if (x == y) {\r\n            rs = x;\r\n        }\r\n        else if (y > x) {\r\n            let v = (y - x) * (s == null ? Math.random() : s) + x;\r\n            rs = v.toFixed();\r\n        }\r\n        else {\r\n            throw `x > y`;\r\n        }\r\n        return Number(rs);\r\n    }\r\n    onDisable() {\r\n        lwg.Global._stageClick = true;\r\n        ADManager.ShowBanner();\r\n    }\r\n}\r\nexport var LotteryGift;\r\n(function (LotteryGift) {\r\n    LotteryGift[LotteryGift[\"prop1\"] = 0] = \"prop1\";\r\n    LotteryGift[LotteryGift[\"prop2\"] = 1] = \"prop2\";\r\n    LotteryGift[LotteryGift[\"prop3\"] = 2] = \"prop3\";\r\n    LotteryGift[LotteryGift[\"prop4\"] = 3] = \"prop4\";\r\n    LotteryGift[LotteryGift[\"prop5\"] = 4] = \"prop5\";\r\n    LotteryGift[LotteryGift[\"prop6\"] = 5] = \"prop6\";\r\n})(LotteryGift || (LotteryGift = {}));\r\nexport var RewardDec;\r\n(function (RewardDec) {\r\n    RewardDec[\"prop1\"] = \"\\u4F53\\u529Bx3\";\r\n    RewardDec[\"prop2\"] = \"\\u81EA\\u95ED\\u9E2D\\u5B50\";\r\n    RewardDec[\"prop3\"] = \"\\u91D1\\u5E01x30\";\r\n    RewardDec[\"prop4\"] = \"\\u4F53\\u529Bx2\";\r\n    RewardDec[\"prop5\"] = \"\\u9EC4\\u76AE\\u8017\\u5B50\";\r\n    RewardDec[\"prop6\"] = \"\\u91D1\\u5E01x60\";\r\n})(RewardDec || (RewardDec = {}));\r\nexport var RewardSkin;\r\n(function (RewardSkin) {\r\n    RewardSkin[\"prop1\"] = \"UI_new/conmmon/icon_execution_big.png\";\r\n    RewardSkin[\"prop2\"] = \"CaiDanQIang/Skin/1.png\";\r\n    RewardSkin[\"prop3\"] = \"UI_new/conmmon/icon_gold_big.png\";\r\n    RewardSkin[\"prop4\"] = \"UI_new/conmmon/icon_execution_big.png\";\r\n    RewardSkin[\"prop5\"] = \"CaiDanQIang/Skin/0.png\";\r\n    RewardSkin[\"prop6\"] = \"UI_new/conmmon/icon_gold_big.png\";\r\n})(RewardSkin || (RewardSkin = {}));\r\n",
  "references": [
    "D:/Game/project/Riddle/Riddle1/TJ3Demo_Promo/src/ZhuanPan/RotateSelfPro.ts",
    "D:/Game/project/Riddle/Riddle1/TJ3Demo_Promo/src/ZhuanPan/RotateSelfPro.ts",
    "D:/Game/project/Riddle/Riddle1/TJ3Demo_Promo/src/script/Lwg_Template/lwg.ts",
    "D:/Game/project/Riddle/Riddle1/TJ3Demo_Promo/src/TJ/Admanager.ts"
  ]
}
