{
  "code": "import RotateSelfPro from \"./RotateSelfPro\";\r\nexport default class ZhuanPan extends Laya.Script {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.lotteryProps = [];\r\n        this.firstUseed = \"1\";\r\n        this.lotteryGift = LotteryGift.prop1;\r\n        this.lotteryindex = 0;\r\n        this.BtnState = 0;\r\n        this.lotterypropsshow = [];\r\n        this.ImageX = 0;\r\n        this.ImageY = 0;\r\n        this.ImageCanMove = false;\r\n        this.CanGet = false;\r\n    }\r\n    onAwake() {\r\n        let Reward;\r\n        (function (Reward) {\r\n            Reward[Reward[\"execution*3\"] = 0] = \"execution*3\";\r\n            Reward[Reward[\"pikaqiu\"] = 1] = \"pikaqiu\";\r\n            Reward[Reward[\"gold*30\"] = 2] = \"gold*30\";\r\n            Reward[Reward[\"execution*2\"] = 3] = \"execution*2\";\r\n            Reward[Reward[\"kedaya\"] = 4] = \"kedaya\";\r\n            Reward[Reward[\"gold*60\"] = 5] = \"gold*60\";\r\n        })(Reward || (Reward = {}));\r\n        this.Zhuanpan = this.owner;\r\n        this.zhuanpanParent = this.Zhuanpan.getChildByName(\"zhuanpanParent\");\r\n        this.RewardPanel = this.Zhuanpan.getChildByName(\"RewardPanel\");\r\n        this.StartBtn = this.Zhuanpan.getChildByName(\"StartBtn\");\r\n        this.ZhuanpanBG = this.zhuanpanParent.getChildByName(\"ZhunpanBG\");\r\n        this.ZhuanpanZhizhen = this.zhuanpanParent.getChildByName(\"ZhiZhen\");\r\n        this.BG = this.ZhuanpanBG.getChildByName(\"BG\");\r\n        for (let index = 0; index < this.BG.numChildren; index++) {\r\n            this.lotteryProps.push(this.BG.getChildAt(index));\r\n        }\r\n        this.RewardPanelInit();\r\n        this._rotateSelfPro = this.zhuanpanParent.getComponent(RotateSelfPro);\r\n        this._rotateSelfPro.OpenZhiZhen();\r\n        this.StartBtn.on(Laya.Event.CLICK, this, this.ZhunapanStart);\r\n        this.CaiDanMoveInit();\r\n        this.First = this.StartBtn.getChildByName(\"First\");\r\n        this.Second = this.StartBtn.getChildByName(\"Second\");\r\n        this.RefreshBtn();\r\n    }\r\n    RefreshBtn() {\r\n        this.firstUseed = Laya.LocalStorage.getItem(\"firstUseed\");\r\n        if (this.firstUseed) {\r\n            if (this.firstUseed == \"0\") {\r\n                this.First.visible = true;\r\n                this.Second.visible = false;\r\n            }\r\n            else {\r\n                this.First.visible = false;\r\n                this.Second.visible = true;\r\n            }\r\n        }\r\n        else {\r\n            this.First.visible = true;\r\n            this.Second.visible = false;\r\n            Laya.LocalStorage.setItem(\"firstUseed\", \"0\");\r\n        }\r\n    }\r\n    ZhunapanStart() {\r\n        console.log(\"点击转盘\");\r\n        if (this.First.visible) {\r\n            Laya.LocalStorage.setItem(\"firstUseed\", \"1\");\r\n            this.StartLottery();\r\n            this.StartBtn.visible = false;\r\n        }\r\n        else {\r\n            console.log(\"看广告\");\r\n            this.StartLottery();\r\n            this.StartBtn.visible = false;\r\n        }\r\n    }\r\n    StartLottery() {\r\n        this._rotateSelfPro.AddSpeed();\r\n        this._rotateSelfPro.OpenZhiZhen();\r\n        Laya.timer.once(1500, this, this.StopLottery);\r\n    }\r\n    StopLottery() {\r\n        console.log(\"转盘停止\");\r\n        let ran = this.randomInRange_i(0, 100);\r\n        if (ran >= 0 && ran < 1) {\r\n            this.lotteryGift = LotteryGift.prop1;\r\n        }\r\n        else if (ran >= 1 && ran < 36) {\r\n            this.lotteryGift = LotteryGift.prop2;\r\n        }\r\n        else if (ran >= 36 && ran < 66) {\r\n            this.lotteryGift = LotteryGift.prop3;\r\n        }\r\n        else if (ran >= 66 && ran < 68) {\r\n            this.lotteryGift = LotteryGift.prop4;\r\n        }\r\n        else if (ran >= 68 && ran < 100) {\r\n            this.lotteryGift = LotteryGift.prop5;\r\n        }\r\n        let degree = 60 * this.lotteryGift + this.randomInRange_i(25, 35);\r\n        this._rotateSelfPro.StopSpeed(degree, () => {\r\n            this.RewardPanel.visible = true;\r\n            this.lotteryindex = this.lotteryGift;\r\n            switch (this.lotteryGift) {\r\n                case 0:\r\n                    this.BtnState = 0;\r\n                    this.ADaction = () => {\r\n                    };\r\n                    this.Normalaction = () => {\r\n                        console.log(\"点击获取\", this.lotteryGift);\r\n                    };\r\n                    break;\r\n                case 1:\r\n                    this.BtnState = 0;\r\n                    this.ADaction = () => {\r\n                    };\r\n                    this.Normalaction = () => {\r\n                        console.log(\"点击获取\", this.lotteryGift);\r\n                    };\r\n                    break;\r\n                case 2:\r\n                    this.BtnState = 0;\r\n                    this.ADaction = () => {\r\n                    };\r\n                    this.Normalaction = () => {\r\n                        console.log(\"点击获取\", this.lotteryGift);\r\n                    };\r\n                    break;\r\n                case 3:\r\n                    this.BtnState = 0;\r\n                    this.ADaction = () => {\r\n                    };\r\n                    this.Normalaction = () => {\r\n                        console.log(\"点击获取\", this.lotteryGift);\r\n                    };\r\n                    break;\r\n                case 4:\r\n                    this.BtnState = 0;\r\n                    this.ADaction = () => {\r\n                    };\r\n                    this.Normalaction = () => {\r\n                        console.log(\"点击获取\", this.lotteryGift);\r\n                    };\r\n                    break;\r\n                case 5:\r\n                    this.BtnState = 0;\r\n                    this.ADaction = () => {\r\n                    };\r\n                    this.Normalaction = () => {\r\n                        console.log(\"点击获取\", this.lotteryGift);\r\n                    };\r\n                    break;\r\n            }\r\n            console.log(\"获取礼物\", this.lotteryGift + 1);\r\n            this.ShowReward();\r\n        });\r\n    }\r\n    RewardPanelInit() {\r\n        this.RewardPanel.visible = false;\r\n        this.CloseRewardBtn = this.RewardPanel.getChildByName(\"CloseRewardBtn\");\r\n        this.lotteryShowBg = this.RewardPanel.getChildByName(\"Bg\");\r\n        this.Props = this.lotteryShowBg.getChildByName(\"Props\");\r\n        this.GetReward = this.lotteryShowBg.getChildByName(\"GetReward\");\r\n        this.ADGetReward = this.lotteryShowBg.getChildByName(\"ADGetReward\");\r\n        for (let i = 0; i < this.Props.numChildren; i++) {\r\n            this.lotterypropsshow.push(this.Props.getChildAt(i));\r\n        }\r\n        this.GetReward.on(Laya.Event.CLICK, this, this.GetRewardClick);\r\n        this.ADGetReward.on(Laya.Event.CLICK, this, this.ADGetRewardClick);\r\n        this.CloseRewardBtn.on(Laya.Event.CLICK, this, () => {\r\n            this.RewardPanel.visible = false;\r\n        });\r\n    }\r\n    ShowReward() {\r\n        this.RefreshBtn();\r\n        this.StartBtn.visible = true;\r\n        this.GetReward.visible = false;\r\n        this.ADGetReward.visible = false;\r\n        this.RewardPanel.visible = true;\r\n        this.lotterypropsshow.forEach((v, i) => {\r\n            if (this.lotteryindex == i) {\r\n                v.visible = true;\r\n            }\r\n            else {\r\n                v.visible = false;\r\n            }\r\n        });\r\n        if (this.BtnState == 0) {\r\n            this.GetReward.visible = true;\r\n        }\r\n        else {\r\n            this.ADGetReward.visible = true;\r\n        }\r\n        this.CloseRewardBtn.visible = this.ADGetReward.visible;\r\n    }\r\n    GetRewardClick() {\r\n        if (this.Normalaction != null) {\r\n            this.Normalaction();\r\n        }\r\n        this.ClosePanel();\r\n    }\r\n    ADGetRewardClick() {\r\n        if (this.ADaction != null) {\r\n            console.log(\"看广告\");\r\n            this.ADaction();\r\n        }\r\n        this.ClosePanel();\r\n    }\r\n    ClosePanel() {\r\n        this.RewardPanel.visible = false;\r\n    }\r\n    CaiDanMoveInit() {\r\n        this.CaiDanParnet = this.lotteryProps[this.lotteryProps.length - 1];\r\n        this.CaidanImage = this.CaiDanParnet.getChildAt(1);\r\n        console.log(\"CaiDanParnet\", this.CaiDanParnet, \"CaidanImage\", this.CaidanImage);\r\n        this.RefreshCaiDan();\r\n    }\r\n    RefreshCaiDan() {\r\n        let use = Laya.LocalStorage.getItem(\"LotteryCaidan\");\r\n        if (use) {\r\n            if (use == \"0\") {\r\n                this.CaidanImage.on(Laya.Event.MOUSE_DOWN, this, this.CaiDanDown);\r\n                this.CaidanImage.on(Laya.Event.MOUSE_UP, this, this.CaiDanUp);\r\n                this.CaidanImage.on(Laya.Event.MOUSE_OUT, this, this.CaidanMoveOut);\r\n            }\r\n            else {\r\n                this.CaidanImage.off(Laya.Event.MOUSE_DOWN, this, this.CaiDanDown);\r\n                this.CaidanImage.off(Laya.Event.MOUSE_UP, this, this.CaiDanUp);\r\n                this.CaidanImage.off(Laya.Event.MOUSE_OUT, this, this.CaidanMoveOut);\r\n            }\r\n        }\r\n        else {\r\n            Laya.LocalStorage.setItem(\"LotteryCaidan\", \"0\");\r\n            this.CaidanImage.on(Laya.Event.MOUSE_DOWN, this, this.CaiDanDown);\r\n            this.CaidanImage.on(Laya.Event.MOUSE_UP, this, this.CaiDanUp);\r\n            this.CaidanImage.on(Laya.Event.MOUSE_OUT, this, this.CaidanMoveOut);\r\n        }\r\n        this.ImageX = this.CaidanImage.x;\r\n        this.ImageY = this.CaidanImage.y;\r\n    }\r\n    CaiDanDown() {\r\n        console.log(\"彩蛋点击事件\");\r\n        this.CaidanImage.on(Laya.Event.MOUSE_MOVE, this, this.CaiDanMove);\r\n    }\r\n    CaiDanMove() {\r\n        this.CaidanImage.x = this.CaiDanParnet.mouseX;\r\n        this.CaidanImage.y = this.CaiDanParnet.mouseY;\r\n    }\r\n    CaidanMoveOut() {\r\n        this.CaiDanUp();\r\n    }\r\n    CaiDanUp() {\r\n        this.CaidanImage.off(Laya.Event.MOUSE_MOVE, this, this.CaiDanMove);\r\n        let x = Math.abs(this.CaidanImage.x - this.ImageX);\r\n        let y = Math.abs(this.CaidanImage.y - this.ImageY);\r\n        if ((x * x + y * y) > 40000) {\r\n            console.log(\"位置恢复,触发\");\r\n            this.lotteryindex = LotteryGift.prop6;\r\n            this.BtnState = 1;\r\n            this.ADaction = () => {\r\n                Laya.LocalStorage.setItem(\"LotteryCaidan\", \"1\");\r\n                this.RefreshCaiDan();\r\n            };\r\n            this.Normalaction = () => {\r\n                this.RefreshCaiDan();\r\n                console.log(\"点击获取\", this.lotteryGift);\r\n            };\r\n            this.ShowReward();\r\n        }\r\n        else {\r\n            console.log(\"位置恢复,不触发\");\r\n        }\r\n        this.CaidanImage.x = this.ImageX;\r\n        this.CaidanImage.y = this.ImageY;\r\n    }\r\n    CaidanInit() {\r\n        this.Caidan1 = this.Zhuanpan.getChildByName(\"CaiDan1\");\r\n        this.Caidan2 = this.Zhuanpan.getChildByName(\"Caidan2\");\r\n        this.Caidan1item = this.Caidan1.getChildByName(\"Caidan1item\");\r\n        this.Caidan2item = this.Caidan2.getChildByName(\"Caidan2item\");\r\n    }\r\n    randomInRange_i(x, y, s = null) {\r\n        let rs;\r\n        if (x == y) {\r\n            rs = x;\r\n        }\r\n        else if (y > x) {\r\n            let v = (y - x) * (s == null ? Math.random() : s) + x;\r\n            rs = v.toFixed();\r\n        }\r\n        else {\r\n            throw `x > y`;\r\n        }\r\n        return Number(rs);\r\n    }\r\n}\r\nexport var LotteryGift;\r\n(function (LotteryGift) {\r\n    LotteryGift[LotteryGift[\"prop1\"] = 0] = \"prop1\";\r\n    LotteryGift[LotteryGift[\"prop2\"] = 1] = \"prop2\";\r\n    LotteryGift[LotteryGift[\"prop3\"] = 2] = \"prop3\";\r\n    LotteryGift[LotteryGift[\"prop4\"] = 3] = \"prop4\";\r\n    LotteryGift[LotteryGift[\"prop5\"] = 4] = \"prop5\";\r\n    LotteryGift[LotteryGift[\"prop6\"] = 5] = \"prop6\";\r\n})(LotteryGift || (LotteryGift = {}));\r\n",
  "references": [
    "D:/Game/project/Riddle/Riddle1/TJ3Demo_Promo/src/ZhuanPan/RotateSelfPro.ts",
    "D:/Game/project/Riddle/Riddle1/TJ3Demo_Promo/src/ZhuanPan/RotateSelfPro.ts"
  ]
}
