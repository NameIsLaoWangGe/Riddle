{
  "code": "import * as tslib_1 from \"tslib\";\r\nimport { lwg } from \"../Lwg_Template/lwg\";\r\nvar UIMain_Gongzhu = (function (_super) {\r\n    tslib_1.__extends(UIMain_Gongzhu, _super);\r\n    function UIMain_Gongzhu() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.necklace = false;\r\n        _this.drumstick = false;\r\n        _this.inAir = false;\r\n        _this.targetP = new Laya.Point();\r\n        _this.attackSwitch = false;\r\n        _this.speed = 2.5;\r\n        _this._belongX = null;\r\n        _this._belongY = null;\r\n        _this._belongChange = false;\r\n        return _this;\r\n    }\r\n    UIMain_Gongzhu.prototype.lwgInit = function () {\r\n        this.createskeleton();\r\n        this.notCommon();\r\n        this.createPlaint();\r\n        this.setBelongRoom();\r\n        this.directionJudge();\r\n    };\r\n    UIMain_Gongzhu.prototype.notCommon = function () {\r\n        this.buffState = null;\r\n        this.signSkin = 'Room/icon_love.png';\r\n    };\r\n    UIMain_Gongzhu.prototype.createPlaint = function () {\r\n        var img = new Laya.Image();\r\n        img.skin = this.signSkin;\r\n        img.y = -50;\r\n        img.x = this.self.width / 2 - 8 - img.width / 2;\r\n        this.self.addChild(img);\r\n        img.zOrder = 10;\r\n        this.plaint = img;\r\n    };\r\n    UIMain_Gongzhu.prototype.directionJudge = function () {\r\n        var pic = this.self.getChildByName('pic');\r\n        if (pic.scaleX === -1) {\r\n            this.moveDirection = lwg.Enum.PersonDir.left;\r\n        }\r\n        else if (pic.scaleX === 1) {\r\n            this.moveDirection = lwg.Enum.PersonDir.right;\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.createskeleton = function () {\r\n        this.skeleton = lwg.Sk.gongzhuTem.buildArmature(0);\r\n        this.self.addChild(this.skeleton);\r\n        this.skeleton.pos(this.self.width / 2, this.self.height - 8);\r\n        var pic = this.self.getChildByName('pic');\r\n        pic.visible = false;\r\n        this.skeleton.play(lwg.Enum.gongzhuAni.walk, true);\r\n    };\r\n    UIMain_Gongzhu.prototype.setBelongRoom = function () {\r\n        for (var index = 0; index < this.selfScene.numChildren; index++) {\r\n            var child = this.selfScene.getChildAt(index);\r\n            if (child.name.substring(0, 4) === 'Room') {\r\n                var dx = Math.abs(child.x - this.self.x);\r\n                var dy = Math.abs(child.y - this.self.y);\r\n                if (dx <= child.width / 2 && dy <= child.height / 2) {\r\n                    this.belongRoom = child;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.onTriggerEnter = function (other, self) {\r\n        if (!lwg.Global._gameStart) {\r\n            return;\r\n        }\r\n        switch (other.label) {\r\n            case 'wall':\r\n                this.wallAndPerson(other, self);\r\n                break;\r\n            case 'floor':\r\n                this.floorAndPerson(other, self);\r\n                break;\r\n            case 'ladder':\r\n                this.ladderAndPerson(other, self);\r\n                break;\r\n            case 'aisle':\r\n                this.aisleAndPerson(other, self);\r\n                break;\r\n            case 'dog':\r\n                this.dogAndPerson(other, self);\r\n                break;\r\n            case 'wangzi':\r\n                this.wangziAndPerson(other, self);\r\n                break;\r\n            case 'stick':\r\n                this.stickAndPerson(other, self);\r\n                break;\r\n            case 'kettle':\r\n                this.kettleAndPerson(other, self);\r\n                break;\r\n            case 'bonfire':\r\n                this.bonfireAndPerson(other, self);\r\n                break;\r\n            case 'necklace':\r\n                this.necklaceAndPerson(other, self);\r\n                break;\r\n            case 'speed':\r\n                this.speedAndPerson(other, self);\r\n                break;\r\n            case 'banana':\r\n                this.bananaAndPerson(other, self);\r\n                break;\r\n            case 'drumstick':\r\n                this.drumstickAndPerson(other, self);\r\n                break;\r\n            case 'houma':\r\n                this.houmaAndPerson(other, self);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.houmaAndPerson = function (other, self) {\r\n        var _this = this;\r\n        console.log('houma');\r\n        var otherOwner = other.owner;\r\n        var otherOwnerName = otherOwner.name;\r\n        if (this.drumstick) {\r\n            return;\r\n        }\r\n        else {\r\n            this.attackSwitch = true;\r\n            otherOwner['UIMain_Houma'].attackSwitch = true;\r\n            var apple_1 = otherOwner.getChildByName('apple');\r\n            apple_1.visible = true;\r\n            Laya.timer.frameOnce(50, this, function (f) {\r\n                _this.skeleton.play(lwg.Enum.gongzhuAni.die, false);\r\n                apple_1.visible = false;\r\n                Laya.timer.frameOnce(100, _this, function (f) {\r\n                    lwg.Admin._openScene('UIPassHint', null, null, null);\r\n                });\r\n            });\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.drumstickAndPerson = function (other, self) {\r\n        var otherOwner = other.owner;\r\n        var otherOwnerName = otherOwner.name;\r\n        otherOwner.removeSelf();\r\n        this.drumstick = true;\r\n    };\r\n    UIMain_Gongzhu.prototype.bananaAndPerson = function (other, self) {\r\n        var otherOwner = other.owner;\r\n        var otherOwnerName = otherOwner.name;\r\n        otherOwner.removeSelf();\r\n        lwg.Global._gameStart = false;\r\n        this.skeleton.play(lwg.Enum.gongzhuAni.die, false);\r\n        Laya.timer.frameOnce(100, this, function (f) {\r\n            lwg.Admin._openScene('UIPassHint', null, null, null);\r\n        });\r\n    };\r\n    UIMain_Gongzhu.prototype.speedAndPerson = function (other, self) {\r\n        var otherOwner = other.owner;\r\n        var otherOwnerName = otherOwner.name;\r\n        otherOwner.removeSelf();\r\n        this.speed = this.speed * 2;\r\n    };\r\n    UIMain_Gongzhu.prototype.necklaceAndPerson = function (other, self) {\r\n        var otherOwner = other.owner;\r\n        var otherOwnerName = otherOwner.name;\r\n        this.necklace = true;\r\n        this.skeleton.play(lwg.Enum.gongzhuAni.walk_xianglian, true);\r\n        otherOwner.removeSelf();\r\n    };\r\n    UIMain_Gongzhu.prototype.bonfireAndPerson = function (other, self) {\r\n        var _this = this;\r\n        var otherOwner = other.owner;\r\n        var otherOwnerName = otherOwner.name;\r\n        if (this.buffState === lwg.Enum.BuffState.kettle) {\r\n            this.skeleton.play(lwg.Enum.gongzhuAni.attack_shuihu, false);\r\n            this.attackSwitch = true;\r\n            Laya.timer.frameOnce(100, this, function (f) {\r\n                otherOwner.removeSelf();\r\n                _this.attackSwitch = false;\r\n                _this.skeleton.play(lwg.Enum.gongzhuAni.walk_shuihu, true);\r\n            });\r\n            this.skeleton.on(Laya.Event.LABEL, this, this.shuihuComplete, [otherOwner]);\r\n        }\r\n        else {\r\n            lwg.Global._gameStart = false;\r\n            Laya.timer.frameOnce(100, this, function (f) {\r\n                lwg.Admin._openScene('UIPassHint', null, null, null);\r\n            });\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.shuihuComplete = function () {\r\n    };\r\n    UIMain_Gongzhu.prototype.kettleAndPerson = function (other, self) {\r\n        var otherOwner = other.owner;\r\n        var otherOwnerName = otherOwner.name;\r\n        this.buffState = lwg.Enum.BuffState.kettle;\r\n        this.skeleton.play(lwg.Enum.gongzhuAni.walk_shuihu, true);\r\n        otherOwner.removeSelf();\r\n    };\r\n    UIMain_Gongzhu.prototype.stickAndPerson = function (other, self) {\r\n        var otherOwner = other.owner;\r\n        this.skeleton.play(lwg.Enum.gongzhuAni.walk_gun, true);\r\n        this.buffState = lwg.Enum.BuffState.stick;\r\n        otherOwner.removeSelf();\r\n    };\r\n    UIMain_Gongzhu.prototype.dogAndPerson = function (other, self) {\r\n        var otherOwner = other.owner;\r\n        var otherOwnerName = otherOwner.name;\r\n        this.attackSwitch = true;\r\n        if (otherOwnerName.substring(0, 1) === 'm') {\r\n            otherOwner['Dog'].eatFood = true;\r\n        }\r\n        if (this.buffState === lwg.Enum.BuffState.stick) {\r\n            this.skeleton.play(lwg.Enum.gongzhuAni.attack_gun, false);\r\n            this.skeleton.on(Laya.Event.LABEL, this, this.attackComplete, [otherOwner]);\r\n        }\r\n        else {\r\n            lwg.Global._gameStart = false;\r\n            this.targetP.x = this.self.x;\r\n            this.targetP.y = this.self.y;\r\n            this.skeleton.play(lwg.Enum.gongzhuAni.die, false);\r\n            if (otherOwnerName.substring(0, 1) === 's') {\r\n                otherOwner['UIMain_StaticDog'].skeleton.play(lwg.Enum.dogAni.walk, true);\r\n            }\r\n            else if (otherOwnerName.substring(0, 1) === 'm') {\r\n                otherOwner['Dog'].skeleton.play(lwg.Enum.dogAni.walk, true);\r\n            }\r\n            Laya.timer.frameOnce(100, this, function (f) {\r\n                lwg.Admin._openScene('UIPassHint', null, null, null);\r\n            });\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.attackComplete = function (otherOwner) {\r\n        var otherOwnerName = otherOwner.name;\r\n        if (otherOwnerName.substring(0, 1) === 's') {\r\n            var dogSk = otherOwner['UIMain_StaticDog'].skeleton;\r\n            dogSk.play(lwg.Enum.dogAni.die, false);\r\n        }\r\n        else if (otherOwnerName.substring(0, 1) === 'm') {\r\n            otherOwner['Dog'].skeleton.play(lwg.Enum.dogAni.die);\r\n        }\r\n        this.skeleton.play(lwg.Enum.gongzhuAni.walk_gun, true);\r\n        this.attackSwitch = false;\r\n        Laya.timer.frameOnce(30, this, function (f) {\r\n            otherOwner.removeSelf();\r\n        });\r\n    };\r\n    UIMain_Gongzhu.prototype.wallAndPerson = function (other, self) {\r\n        if (this.moveDirection === lwg.Enum.PersonDir.left || this.moveDirection === lwg.Enum.PersonDir.right) {\r\n            this.changeDirection();\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.wangziAndPerson = function (other, self) {\r\n        lwg.Global._gameStart = false;\r\n        var otherOwner = other.owner;\r\n        var otherOwnerName = otherOwner.name;\r\n        this.targetP.x = this.self.x;\r\n        this.targetP.y = this.self.y;\r\n        otherOwner['UIMain_Wangzi'].skeleton.play(lwg.Enum.wangziAni.win, true);\r\n        this.skeleton.play(lwg.Enum.gongzhuAni.win, true);\r\n        Laya.timer.frameOnce(60, this, function (f) {\r\n            lwg.Admin._openScene('UIVictory', null, null, null);\r\n        });\r\n    };\r\n    UIMain_Gongzhu.prototype.floorAndPerson = function (other, self) {\r\n        var otherOwner = other.owner;\r\n        var otherOwnerName = otherOwner.name;\r\n        var belongName = otherOwnerName.substring(otherOwnerName.length - 5, otherOwnerName.length);\r\n        if (this.belongRoom.name === belongName) {\r\n            if (this.personState === lwg.Enum.MoveState.onLadder) {\r\n                this.moveDirection = this.beforeLadderDir;\r\n            }\r\n            else if (this.personState === lwg.Enum.MoveState.inAir) {\r\n                this.moveDirection = this.beforeInAirDir;\r\n            }\r\n            this.personState = lwg.Enum.MoveState.onFloor;\r\n            this.currentFloor = otherOwner;\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.ladderAndPerson = function (other, self) {\r\n        var otherOwner = other.owner;\r\n        var otherName = otherOwner.name;\r\n        var otherNamelen = otherOwner.name.length;\r\n        var num = otherOwner.name.substring(otherNamelen - 2, otherNamelen);\r\n        var aisleName = 'up_Aisle_' + num;\r\n        var upAisle = this.belongRoom.getChildByName(aisleName);\r\n        if (!upAisle) {\r\n            if (otherOwner.name.substring(0, 8) === 'ladder_a') {\r\n                if (this.personState !== lwg.Enum.MoveState.onLadder) {\r\n                    if (other.y > otherOwner.width / 2) {\r\n                        this.beforeLadderDir = this.moveDirection;\r\n                        this.moveDirection = lwg.Enum.PersonDir.up;\r\n                        this.personState = lwg.Enum.MoveState.onLadder;\r\n                    }\r\n                    else {\r\n                        this.beforeLadderDir = this.moveDirection;\r\n                        this.moveDirection = lwg.Enum.PersonDir.down;\r\n                        this.personState = lwg.Enum.MoveState.onLadder;\r\n                    }\r\n                    this.currentLadder = otherOwner;\r\n                }\r\n            }\r\n            return;\r\n        }\r\n        var upOpenSwitch = upAisle['UIMain_Aisle'].openSwitch;\r\n        if (!upOpenSwitch) {\r\n        }\r\n        else {\r\n            if (this.personState === lwg.Enum.MoveState.onFloor) {\r\n                this.beforeLadderDir = this.moveDirection;\r\n                this.moveDirection = lwg.Enum.PersonDir.up;\r\n                this.personState = lwg.Enum.MoveState.onLadder;\r\n            }\r\n            else {\r\n                if (this.beforeInAirDir === lwg.Enum.PersonDir.left || this.beforeInAirDir === lwg.Enum.PersonDir.right) {\r\n                    this.beforeLadderDir = this.beforeInAirDir;\r\n                    this.personState = lwg.Enum.MoveState.onLadder;\r\n                    this.moveDirection = lwg.Enum.PersonDir.down;\r\n                }\r\n            }\r\n            this.currentLadder = otherOwner;\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.aisleAndPerson = function (other, self) {\r\n        var otherOwner = other.owner;\r\n        var otherName = otherOwner.name;\r\n        var openSwitch = otherOwner['UIMain_Aisle'].openSwitch;\r\n        var connectRoom = otherOwner['UIMain_Aisle'].connectRoom;\r\n        var otherDir = otherName.substring(0, 1);\r\n        var selfDir = this.moveDirection.substring(0, 1);\r\n        if (otherDir === 'l' || otherDir === 'r') {\r\n            if (openSwitch === false) {\r\n                var lrAisle = this.belongRoom.getChildByName(otherOwner.name);\r\n                if (otherOwner === lrAisle) {\r\n                    this.changeDirection();\r\n                }\r\n            }\r\n            else {\r\n                if (otherDir === selfDir) {\r\n                    if (this.belongRoom !== connectRoom) {\r\n                        this.belongRoom = connectRoom;\r\n                        this._belongChange = true;\r\n                        this.beforeInAirDir = this.moveDirection;\r\n                        this.personState = lwg.Enum.MoveState.inAir;\r\n                    }\r\n                }\r\n                else {\r\n                }\r\n            }\r\n        }\r\n        else if (otherDir === 'd' || otherDir === 'u') {\r\n            if (otherDir === 'd') {\r\n                if (openSwitch === false) {\r\n                }\r\n                else {\r\n                    if (selfDir === 'l' || selfDir === 'r') {\r\n                        if (this.belongRoom !== connectRoom) {\r\n                            this.belongRoom = connectRoom;\r\n                            this._belongChange = true;\r\n                            this.beforeInAirDir = this.moveDirection;\r\n                            this.personState = lwg.Enum.MoveState.inAir;\r\n                            this.moveDirection = lwg.Enum.PersonDir.down;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else if (otherDir === 'u') {\r\n                if (openSwitch === false) {\r\n                    var upAisle = this.belongRoom.getChildByName(otherOwner.name);\r\n                    if (otherOwner === upAisle) {\r\n                        this.changeDirection();\r\n                    }\r\n                }\r\n                else {\r\n                    if (otherDir === selfDir) {\r\n                        if (this.belongRoom !== connectRoom) {\r\n                            this.belongRoom = connectRoom;\r\n                            this._belongChange = true;\r\n                            this.beforeInAirDir = this.beforeLadderDir;\r\n                            this.personState = lwg.Enum.MoveState.inAir;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.onTriggerExit = function (other, self) {\r\n        if (!lwg.Global._gameStart) {\r\n            return;\r\n        }\r\n        if (other.label === 'floor') {\r\n            var belongName = other.owner.name.substring(other.owner.name.length - 5, other.owner.name.length);\r\n            if (this.belongRoom.name === belongName) {\r\n                if (this.personState !== lwg.Enum.MoveState.onLadder) {\r\n                    this.beforeInAirDir = this.moveDirection;\r\n                    this.personState = lwg.Enum.MoveState.inAir;\r\n                    this.moveDirection = lwg.Enum.PersonDir.down;\r\n                }\r\n            }\r\n        }\r\n        else if (other.label === 'ladder') {\r\n            var belongName = other.owner.name.substring(other.owner.name.length - 5, other.owner.name.length);\r\n            if (this.belongRoom.name === belongName) {\r\n                if (this.personState === lwg.Enum.MoveState.onFloor) {\r\n                    this.moveDirection = this.beforeFloorDir;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.changeDirection = function () {\r\n        if (this.moveDirection === lwg.Enum.PersonDir.left) {\r\n            this.moveDirection = lwg.Enum.PersonDir.right;\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.right) {\r\n            this.moveDirection = lwg.Enum.PersonDir.left;\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.up) {\r\n            this.moveDirection = lwg.Enum.PersonDir.down;\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.down) {\r\n            this.moveDirection = lwg.Enum.PersonDir.up;\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.move = function () {\r\n        if (this.attackSwitch) {\r\n            this.rig.setVelocity({ x: 0, y: 0 });\r\n            return;\r\n        }\r\n        if (this.moveDirection === lwg.Enum.PersonDir.left) {\r\n            this.rig.setVelocity({ x: -this.speed, y: 0 });\r\n            this.skeleton.scaleX = -1;\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.right) {\r\n            this.rig.setVelocity({ x: this.speed, y: 0 });\r\n            this.skeleton.scaleX = 1;\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.up) {\r\n            this.rig.setVelocity({ x: 0, y: -6 });\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.down) {\r\n            this.rig.setVelocity({ x: 0, y: 6 });\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.noMoveDirection = function () {\r\n        if (!this.moveDirection) {\r\n            this.moveDirection = lwg.Enum.PersonDir.left;\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.positionOffset = function () {\r\n        if (this.belongRoom) {\r\n            switch (this.personState) {\r\n                case lwg.Enum.MoveState.onFloor:\r\n                    if (this.currentFloor) {\r\n                        var y = this.currentFloor.y + this.belongRoom.y - this.belongRoom.height / 2;\r\n                        this.self.y = y - 20;\r\n                        this.positionOffsetXY();\r\n                    }\r\n                    break;\r\n                case lwg.Enum.MoveState.onLadder:\r\n                    if (this.currentLadder) {\r\n                        var x = this.currentLadder.x + this.belongRoom.x - this.belongRoom.width / 2;\r\n                        this.self.x = x;\r\n                        this.positionOffsetXY();\r\n                    }\r\n                    break;\r\n                case lwg.Enum.MoveState.inAir:\r\n                    this.positionOffsetXY();\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.positionOffsetXY = function () {\r\n        if (!this._belongY || !this._belongX) {\r\n            if (this.belongRoom) {\r\n                this._belongX = this.belongRoom.x;\r\n                this._belongY = this.belongRoom.y;\r\n            }\r\n        }\r\n        else {\r\n            if (this._belongChange) {\r\n                this._belongY = null;\r\n                this._belongChange = false;\r\n            }\r\n            else {\r\n                var x = this.belongRoom.x - this._belongX;\r\n                var y = this.belongRoom.y - this._belongY;\r\n                this.self.x = this.self.x + x;\r\n                this.self.y = this.self.y + y;\r\n                this._belongX = this.belongRoom.x;\r\n                this._belongY = this.belongRoom.y;\r\n            }\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.gameOverMove = function () {\r\n        if (this.targetP) {\r\n            this.positionOffsetXY();\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.scopeControl = function () {\r\n        if (this.belongRoom) {\r\n            if (this.self.x > this.belongRoom.x + this.belongRoom.width / 2 + 30) {\r\n                this.self.x = this.belongRoom.x + this.belongRoom.width / 2 + 30;\r\n            }\r\n            if (this.self.x < this.belongRoom.x - this.belongRoom.width / 2 - 30) {\r\n                this.self.x = this.belongRoom.x - this.belongRoom.width / 2 - 30;\r\n            }\r\n            if (this.self.y > this.belongRoom.y + this.belongRoom.height / 2 + 30) {\r\n                this.self.y = this.belongRoom.y + this.belongRoom.height / 2 + 30;\r\n            }\r\n            if (this.self.y < this.belongRoom.y - this.belongRoom.height / 2 - 30) {\r\n                this.self.y = this.belongRoom.y - this.belongRoom.height / 2 - 30;\r\n            }\r\n        }\r\n    };\r\n    UIMain_Gongzhu.prototype.onUpdate = function () {\r\n        if (!lwg.Global._gameStart) {\r\n            this.rig.setVelocity({ x: 0, y: 0 });\r\n            this.gameOverMove();\r\n            return;\r\n        }\r\n        this.noMoveDirection();\r\n        this.move();\r\n        this.positionOffset();\r\n        this.scopeControl();\r\n    };\r\n    UIMain_Gongzhu.prototype.onDisable = function () {\r\n    };\r\n    return UIMain_Gongzhu;\r\n}(lwg.Admin.Person));\r\nexport default UIMain_Gongzhu;\r\n",
  "references": [
    "D:/Game/project/Riddle/Riddle1/TJ3Demo_Promo/src/script/Lwg_Template/lwg.ts"
  ]
}
