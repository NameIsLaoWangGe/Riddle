{
  "code": "import * as tslib_1 from \"tslib\";\r\nimport PromoItem from \"./PromoItem\";\r\nimport Behaviour from \"./Behaviour\";\r\nvar P205 = (function (_super) {\r\n    tslib_1.__extends(P205, _super);\r\n    function P205() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.promoList = null;\r\n        _this.itemList = [];\r\n        _this.scroll = null;\r\n        _this.layout = null;\r\n        _this.prefab = null;\r\n        _this.paddingTop = 10;\r\n        _this.paddingBottom = 10;\r\n        _this.move = null;\r\n        _this.show = null;\r\n        _this.hide = null;\r\n        _this.maxX = 620;\r\n        _this.line = 0;\r\n        _this.column = 0;\r\n        _this.targetX = 0;\r\n        _this.showing = [];\r\n        return _this;\r\n    }\r\n    P205.prototype.OnAwake = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var button, board, w, _a, i, node, item, h, _i, _b, item;\r\n            var _this = this;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        this.move = this.owner.getChildByName(\"move\");\r\n                        button = this.move.getChildByName(\"button\");\r\n                        this.show = button.getChildByName(\"show\");\r\n                        this.hide = button.getChildByName(\"hide\");\r\n                        board = this.move.getChildByName(\"board\");\r\n                        this.scroll = board.getChildByName(\"scroll\");\r\n                        this.layout = this.scroll.getChildByName(\"layout\");\r\n                        this.prefab = this.layout.getCell(0);\r\n                        this.show.clickHandler = new Laya.Handler(null, function () { _this.Show(); });\r\n                        this.hide.clickHandler = new Laya.Handler(null, function () { _this.Hide(); });\r\n                        w = this.scroll.width - this.paddingTop - this.paddingBottom;\r\n                        while (w >= this.prefab.width) {\r\n                            w = w - this.prefab.width - this.layout.spaceX;\r\n                            this.column++;\r\n                        }\r\n                        TJ.Develop.Yun.Promo.Data.ReportAwake(P205.style);\r\n                        if (this.show.parent.scaleX < 0)\r\n                            this.maxX = -this.maxX;\r\n                        if (TJ.API.AppInfo.Channel() == TJ.Define.Channel.AppRt.ZJTD_AppRt) {\r\n                            return [2];\r\n                        }\r\n                        this.active = false;\r\n                        _a = this;\r\n                        return [4, TJ.Develop.Yun.Promo.List.Get(P205.style)];\r\n                    case 1:\r\n                        _a.promoList = _c.sent();\r\n                        if (this.promoList.count > 0) {\r\n                            TJ.Develop.Yun.Promo.Data.ReportStart(P205.style);\r\n                            this.line = Math.ceil(this.promoList.count / this.column);\r\n                            this.layout.repeatX = this.column;\r\n                            this.layout.repeatY = this.line;\r\n                            for (i = 0; i < this.layout.cells.length; i++) {\r\n                                node = this.layout.getCell(i);\r\n                                if (i < this.promoList.count) {\r\n                                    item = node.getComponent(PromoItem);\r\n                                    if (item != null) {\r\n                                        this.itemList.push(item);\r\n                                        item.style = P205.style;\r\n                                    }\r\n                                    node.active = node.visible = true;\r\n                                }\r\n                                else {\r\n                                    node.active = node.visible = false;\r\n                                }\r\n                            }\r\n                            this.line = Math.ceil(this.itemList.length / this.column);\r\n                            h = this.paddingTop + this.paddingBottom;\r\n                            h += this.prefab.height * this.line + this.layout.spaceY * (this.line - 1);\r\n                            this.layout.height = h;\r\n                            if (this.scroll.height < this.layout.height) {\r\n                                this.scroll.vScrollBarSkin = \"\";\r\n                                this.scroll.vScrollBar.rollRatio = 0;\r\n                            }\r\n                            for (_i = 0, _b = this.itemList; _i < _b.length; _i++) {\r\n                                item = _b[_i];\r\n                                this.LoadIcon(item);\r\n                            }\r\n                            this.active = true;\r\n                        }\r\n                        else {\r\n                            this.owner.destroy();\r\n                        }\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Object.defineProperty(P205.prototype, \"scrollValue\", {\r\n        get: function () {\r\n            if (this.scroll.vScrollBar != null) {\r\n                return this.scroll.vScrollBar.value;\r\n            }\r\n            return 0;\r\n        },\r\n        set: function (v) {\r\n            if (this.scroll.vScrollBar != null) {\r\n                this.scroll.vScrollBar.value = v;\r\n            }\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    P205.prototype.LoadIcon = function (promoItem) {\r\n        var _this = this;\r\n        var data = this.promoList.Load();\r\n        if (data != null) {\r\n            this.promoList.Unload(promoItem.data);\r\n            promoItem.data = data;\r\n            promoItem.onClick_ = function (item) { _this.LoadAndShowIcon(item); };\r\n            promoItem.DoLoad();\r\n        }\r\n        return data;\r\n    };\r\n    P205.prototype.LoadAndShowIcon = function (promoItem) {\r\n        if (this.LoadIcon(promoItem) != null) {\r\n            promoItem.OnShow();\r\n        }\r\n    };\r\n    P205.prototype.Show = function () {\r\n        if (TJ.API.AppInfo.Channel() == TJ.Define.Channel.AppRt.ZJTD_AppRt) {\r\n            var param = new TJ.API.Promo.Param();\r\n            param.extraData = { \"TJ_App\": TJ.API.AppInfo.AppGuid() };\r\n            TJ.API.Promo.Pop(param);\r\n            return;\r\n        }\r\n        this.targetX = this.maxX;\r\n        this.show.active = this.show.visible = false;\r\n        this.hide.active = this.hide.visible = true;\r\n        this.scrollValue = 0;\r\n    };\r\n    P205.prototype.Hide = function () {\r\n        this.targetX = 0;\r\n        this.showing = [];\r\n    };\r\n    P205.prototype.OnUpdate = function () {\r\n        var _this = this;\r\n        var deltaTime = Laya.timer.delta / 1000;\r\n        if (this.move.centerX != this.targetX) {\r\n            var d = this.targetX - this.move.centerX;\r\n            var s = 3000 * deltaTime;\r\n            if (d > 0) {\r\n                d = Math.min(this.move.centerX + s, this.targetX);\r\n            }\r\n            else {\r\n                d = Math.max(this.move.centerX - s, this.targetX);\r\n            }\r\n            this.move.centerX = d;\r\n            if (this.move.centerX == 0) {\r\n                this.show.active = this.show.visible = true;\r\n                this.hide.active = this.hide.visible = false;\r\n                window.setTimeout(function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\r\n                    var _a, _i, _b, item;\r\n                    return tslib_1.__generator(this, function (_c) {\r\n                        switch (_c.label) {\r\n                            case 0:\r\n                                _a = this;\r\n                                return [4, TJ.Develop.Yun.Promo.List.Get(P205.style)];\r\n                            case 1:\r\n                                _a.promoList = _c.sent();\r\n                                for (_i = 0, _b = this.itemList; _i < _b.length; _i++) {\r\n                                    item = _b[_i];\r\n                                    this.LoadIcon(item);\r\n                                }\r\n                                return [2];\r\n                        }\r\n                    });\r\n                }); }, 0);\r\n            }\r\n        }\r\n        else {\r\n            if (this.move.centerX == this.maxX) {\r\n                this.CheckShow();\r\n            }\r\n        }\r\n    };\r\n    P205.prototype.CheckShow = function () {\r\n        for (var _i = 0, _a = this.itemList; _i < _a.length; _i++) {\r\n            var item = _a[_i];\r\n            var i = this.showing.indexOf(item);\r\n            var node = item.owner;\r\n            var d = Math.abs(-node.y - this.paddingTop - this.prefab.height / 2 + this.scrollValue + this.scroll.height / 2);\r\n            if (d < this.scroll.height / 2) {\r\n                if (i < 0) {\r\n                    this.showing.push(item);\r\n                    item.OnShow();\r\n                }\r\n            }\r\n            else {\r\n                if (i >= 0) {\r\n                    this.showing.splice(i, 1);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    P205.style = \"P205\";\r\n    return P205;\r\n}(Behaviour));\r\nexport default P205;\r\n",
  "references": [
    "D:/Game/project/Riddle/Riddle1/TJ3Demo_Promo/src/TJ/Promo/script/PromoItem.ts",
    "D:/Game/project/Riddle/Riddle1/TJ3Demo_Promo/src/TJ/Promo/script/Behaviour.ts"
  ]
}
