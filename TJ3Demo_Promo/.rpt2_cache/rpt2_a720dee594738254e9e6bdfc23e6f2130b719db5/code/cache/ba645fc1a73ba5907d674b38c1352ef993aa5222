{
  "code": "import { lwg } from \"../Lwg_Template/lwg\";\r\nexport default class UIMain_Gongzhu extends lwg.Admin.Person {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.necklace = false;\r\n        this.drumstick = false;\r\n        this.inAir = false;\r\n        this.targetP = new Laya.Point();\r\n        this.attackSwitch = false;\r\n        this.speed = 2.5;\r\n        this._belongX = null;\r\n        this._belongY = null;\r\n        this._belongChange = false;\r\n    }\r\n    lwgInit() {\r\n        this.createskeleton();\r\n        this.notCommon();\r\n        this.createPlaint();\r\n        this.setBelongRoom();\r\n        this.directionJudge();\r\n    }\r\n    notCommon() {\r\n        this.buffState = null;\r\n        this.signSkin = 'Room/icon_love.png';\r\n    }\r\n    createPlaint() {\r\n        let img = new Laya.Image();\r\n        img.skin = this.signSkin;\r\n        img.y = -50;\r\n        img.x = this.self.width / 2 - 8 - img.width / 2;\r\n        this.self.addChild(img);\r\n        img.zOrder = 10;\r\n        this.plaint = img;\r\n    }\r\n    directionJudge() {\r\n        let pic = this.self.getChildByName('pic');\r\n        if (pic.scaleX === -1) {\r\n            this.moveDirection = lwg.Enum.PersonDir.left;\r\n        }\r\n        else if (pic.scaleX === 1) {\r\n            this.moveDirection = lwg.Enum.PersonDir.right;\r\n        }\r\n    }\r\n    createskeleton() {\r\n        this.skeleton = lwg.Sk.gongzhuTem.buildArmature(0);\r\n        this.self.addChild(this.skeleton);\r\n        this.skeleton.pos(this.self.width / 2, this.self.height - 8);\r\n        let pic = this.self.getChildByName('pic');\r\n        pic.visible = false;\r\n        this.skeleton.play(lwg.Enum.gongzhuAni.walk, true);\r\n    }\r\n    setBelongRoom() {\r\n        for (let index = 0; index < this.selfScene.numChildren; index++) {\r\n            const child = this.selfScene.getChildAt(index);\r\n            if (child.name.substring(0, 4) === 'Room') {\r\n                let dx = Math.abs(child.x - this.self.x);\r\n                let dy = Math.abs(child.y - this.self.y);\r\n                if (dx <= child.width / 2 && dy <= child.height / 2) {\r\n                    this.belongRoom = child;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    onTriggerEnter(other, self) {\r\n        if (!lwg.Global._gameStart) {\r\n            return;\r\n        }\r\n        switch (other.label) {\r\n            case 'wall':\r\n                this.wallAndPerson(other, self);\r\n                break;\r\n            case 'floor':\r\n                this.floorAndPerson(other, self);\r\n                break;\r\n            case 'ladder':\r\n                this.ladderAndPerson(other, self);\r\n                break;\r\n            case 'aisle':\r\n                this.aisleAndPerson(other, self);\r\n                break;\r\n            case 'dog':\r\n                this.dogAndPerson(other, self);\r\n                break;\r\n            case 'wangzi':\r\n                this.wangziAndPerson(other, self);\r\n                break;\r\n            case 'stick':\r\n                this.stickAndPerson(other, self);\r\n                break;\r\n            case 'kettle':\r\n                this.kettleAndPerson(other, self);\r\n                break;\r\n            case 'bonfire':\r\n                this.bonfireAndPerson(other, self);\r\n                break;\r\n            case 'necklace':\r\n                this.necklaceAndPerson(other, self);\r\n                break;\r\n            case 'speed':\r\n                this.speedAndPerson(other, self);\r\n                break;\r\n            case 'banana':\r\n                this.bananaAndPerson(other, self);\r\n                break;\r\n            case 'drumstick':\r\n                this.drumstickAndPerson(other, self);\r\n                break;\r\n            case 'houma':\r\n                this.houmaAndPerson(other, self);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    houmaAndPerson(other, self) {\r\n        console.log('houma');\r\n        let otherOwner = other.owner;\r\n        let otherOwnerName = otherOwner.name;\r\n        if (this.drumstick) {\r\n            return;\r\n        }\r\n        else {\r\n            this.attackSwitch = true;\r\n            otherOwner['UIMain_Houma'].attackSwitch = true;\r\n            let apple = otherOwner.getChildByName('apple');\r\n            apple.visible = true;\r\n            Laya.timer.frameOnce(50, this, f => {\r\n                this.selfScene['UIMain'].victory = false;\r\n                this.skeleton.play(lwg.Enum.gongzhuAni.die, false);\r\n                apple.visible = false;\r\n                Laya.timer.frameOnce(100, this, f => {\r\n                    lwg.Admin._openScene('UIPassHint', null, null, f => {\r\n                        lwg.Admin._sceneControl['UIPassHint']['UIPassHint'].intoScene = lwg.Admin.SceneName.UIDefeated;\r\n                    });\r\n                });\r\n            });\r\n        }\r\n    }\r\n    drumstickAndPerson(other, self) {\r\n        let otherOwner = other.owner;\r\n        let otherOwnerName = otherOwner.name;\r\n        otherOwner.removeSelf();\r\n        this.drumstick = true;\r\n    }\r\n    bananaAndPerson(other, self) {\r\n        let otherOwner = other.owner;\r\n        let otherOwnerName = otherOwner.name;\r\n        otherOwner.removeSelf();\r\n        lwg.Global._gameStart = false;\r\n        this.skeleton.play(lwg.Enum.gongzhuAni.die, false);\r\n        Laya.timer.frameOnce(100, this, f => {\r\n            this.selfScene['UIMain'].victory = false;\r\n            lwg.Admin._openScene('UIPassHint', null, null, f => {\r\n                lwg.Admin._sceneControl['UIPassHint']['UIPassHint'].intoScene = lwg.Admin.SceneName.UIDefeated;\r\n            });\r\n        });\r\n    }\r\n    speedAndPerson(other, self) {\r\n        let otherOwner = other.owner;\r\n        let otherOwnerName = otherOwner.name;\r\n        otherOwner.removeSelf();\r\n        this.speed = this.speed * 2;\r\n    }\r\n    necklaceAndPerson(other, self) {\r\n        let otherOwner = other.owner;\r\n        let otherOwnerName = otherOwner.name;\r\n        this.necklace = true;\r\n        this.skeleton.play(lwg.Enum.gongzhuAni.walk_xianglian, true);\r\n        otherOwner.removeSelf();\r\n    }\r\n    bonfireAndPerson(other, self) {\r\n        let otherOwner = other.owner;\r\n        let otherOwnerName = otherOwner.name;\r\n        if (this.buffState === lwg.Enum.BuffState.kettle) {\r\n            this.skeleton.play(lwg.Enum.gongzhuAni.attack_shuihu, false);\r\n            this.attackSwitch = true;\r\n            Laya.timer.frameOnce(100, this, f => {\r\n                otherOwner.removeSelf();\r\n                this.attackSwitch = false;\r\n                this.skeleton.play(lwg.Enum.gongzhuAni.walk_shuihu, true);\r\n            });\r\n            this.skeleton.on(Laya.Event.LABEL, this, this.shuihuComplete, [otherOwner]);\r\n        }\r\n        else {\r\n            this.skeleton.play(lwg.Enum.gongzhuAni.die, false);\r\n            lwg.Global._gameStart = false;\r\n            Laya.timer.frameOnce(100, this, f => {\r\n                this.selfScene['UIMain'].victory = false;\r\n                lwg.Admin._openScene('UIPassHint', null, null, f => {\r\n                    lwg.Admin._sceneControl['UIPassHint']['UIPassHint'].intoScene = lwg.Admin.SceneName.UIDefeated;\r\n                });\r\n            });\r\n        }\r\n    }\r\n    shuihuComplete() {\r\n    }\r\n    kettleAndPerson(other, self) {\r\n        let otherOwner = other.owner;\r\n        let otherOwnerName = otherOwner.name;\r\n        this.buffState = lwg.Enum.BuffState.kettle;\r\n        this.skeleton.play(lwg.Enum.gongzhuAni.walk_shuihu, true);\r\n        otherOwner.removeSelf();\r\n    }\r\n    stickAndPerson(other, self) {\r\n        let otherOwner = other.owner;\r\n        this.skeleton.play(lwg.Enum.gongzhuAni.walk_gun, true);\r\n        this.buffState = lwg.Enum.BuffState.stick;\r\n        otherOwner.removeSelf();\r\n    }\r\n    dogAndPerson(other, self) {\r\n        let otherOwner = other.owner;\r\n        let otherOwnerName = otherOwner.name;\r\n        this.attackSwitch = true;\r\n        if (otherOwnerName.substring(0, 1) === 'm') {\r\n            otherOwner['Dog'].eatFood = true;\r\n        }\r\n        if (this.buffState === lwg.Enum.BuffState.stick) {\r\n            this.skeleton.play(lwg.Enum.gongzhuAni.attack_gun, false);\r\n            this.skeleton.on(Laya.Event.LABEL, this, this.attackComplete, [otherOwner]);\r\n        }\r\n        else {\r\n            lwg.Global._gameStart = false;\r\n            this.targetP.x = this.self.x;\r\n            this.targetP.y = this.self.y;\r\n            this.skeleton.play(lwg.Enum.gongzhuAni.die, false);\r\n            if (otherOwnerName.substring(0, 1) === 's') {\r\n                otherOwner['UIMain_StaticDog'].skeleton.play(lwg.Enum.dogAni.walk, true);\r\n            }\r\n            else if (otherOwnerName.substring(0, 1) === 'm') {\r\n                otherOwner['Dog'].skeleton.play(lwg.Enum.dogAni.walk, true);\r\n            }\r\n            Laya.timer.frameOnce(100, this, f => {\r\n                this.selfScene['UIMain'].victory = false;\r\n                lwg.Admin._openScene('UIPassHint', null, null, f => {\r\n                    lwg.Admin._sceneControl['UIPassHint']['UIPassHint'].intoScene = lwg.Admin.SceneName.UIDefeated;\r\n                });\r\n            });\r\n        }\r\n    }\r\n    attackComplete(otherOwner) {\r\n        let otherOwnerName = otherOwner.name;\r\n        if (otherOwnerName.substring(0, 1) === 's') {\r\n            let dogSk = otherOwner['UIMain_StaticDog'].skeleton;\r\n            dogSk.play(lwg.Enum.dogAni.die, false);\r\n        }\r\n        else if (otherOwnerName.substring(0, 1) === 'm') {\r\n            otherOwner['Dog'].skeleton.play(lwg.Enum.dogAni.die);\r\n        }\r\n        this.skeleton.play(lwg.Enum.gongzhuAni.walk_gun, true);\r\n        this.attackSwitch = false;\r\n        Laya.timer.frameOnce(30, this, f => {\r\n            otherOwner.removeSelf();\r\n        });\r\n    }\r\n    wallAndPerson(other, self) {\r\n        if (this.moveDirection === lwg.Enum.PersonDir.left || this.moveDirection === lwg.Enum.PersonDir.right) {\r\n            this.changeDirection();\r\n        }\r\n    }\r\n    wangziAndPerson(other, self) {\r\n        lwg.Global._gameStart = false;\r\n        let otherOwner = other.owner;\r\n        let otherOwnerName = otherOwner.name;\r\n        this.targetP.x = this.self.x;\r\n        this.targetP.y = this.self.y;\r\n        otherOwner['UIMain_Wangzi'].skeleton.play(lwg.Enum.wangziAni.win, true);\r\n        this.skeleton.play(lwg.Enum.gongzhuAni.win, true);\r\n        Laya.timer.frameOnce(60, this, f => {\r\n            this.selfScene['UIMain'].victory = true;\r\n            lwg.Admin._openScene('UIVictory', null, null, null);\r\n        });\r\n    }\r\n    floorAndPerson(other, self) {\r\n        let otherOwner = other.owner;\r\n        let otherOwnerName = otherOwner.name;\r\n        let belongName = otherOwnerName.substring(otherOwnerName.length - 5, otherOwnerName.length);\r\n        if (this.belongRoom.name === belongName) {\r\n            if (this.personState === lwg.Enum.MoveState.onLadder) {\r\n                this.moveDirection = this.beforeLadderDir;\r\n            }\r\n            else if (this.personState === lwg.Enum.MoveState.inAir) {\r\n                this.moveDirection = this.beforeInAirDir;\r\n            }\r\n            this.personState = lwg.Enum.MoveState.onFloor;\r\n            this.currentFloor = otherOwner;\r\n        }\r\n    }\r\n    ladderAndPerson(other, self) {\r\n        let otherOwner = other.owner;\r\n        let otherName = otherOwner.name;\r\n        let otherNamelen = otherOwner.name.length;\r\n        let num = otherOwner.name.substring(otherNamelen - 2, otherNamelen);\r\n        let aisleName = 'up_Aisle_' + num;\r\n        let upAisle = this.belongRoom.getChildByName(aisleName);\r\n        if (!upAisle) {\r\n            if (otherOwner.name.substring(0, 8) === 'ladder_a') {\r\n                if (this.personState !== lwg.Enum.MoveState.onLadder) {\r\n                    if (other.y > otherOwner.width / 2) {\r\n                        this.beforeLadderDir = this.moveDirection;\r\n                        this.moveDirection = lwg.Enum.PersonDir.up;\r\n                        this.personState = lwg.Enum.MoveState.onLadder;\r\n                    }\r\n                    else {\r\n                        this.beforeLadderDir = this.moveDirection;\r\n                        this.moveDirection = lwg.Enum.PersonDir.down;\r\n                        this.personState = lwg.Enum.MoveState.onLadder;\r\n                    }\r\n                    this.currentLadder = otherOwner;\r\n                }\r\n            }\r\n            return;\r\n        }\r\n        let upOpenSwitch = upAisle['UIMain_Aisle'].openSwitch;\r\n        if (!upOpenSwitch) {\r\n        }\r\n        else {\r\n            if (this.personState === lwg.Enum.MoveState.onFloor) {\r\n                this.beforeLadderDir = this.moveDirection;\r\n                this.moveDirection = lwg.Enum.PersonDir.up;\r\n                this.personState = lwg.Enum.MoveState.onLadder;\r\n            }\r\n            else {\r\n                if (this.beforeInAirDir === lwg.Enum.PersonDir.left || this.beforeInAirDir === lwg.Enum.PersonDir.right) {\r\n                    this.beforeLadderDir = this.beforeInAirDir;\r\n                    this.personState = lwg.Enum.MoveState.onLadder;\r\n                    this.moveDirection = lwg.Enum.PersonDir.down;\r\n                }\r\n            }\r\n            this.currentLadder = otherOwner;\r\n        }\r\n    }\r\n    aisleAndPerson(other, self) {\r\n        let otherOwner = other.owner;\r\n        let otherName = otherOwner.name;\r\n        let openSwitch = otherOwner['UIMain_Aisle'].openSwitch;\r\n        let connectRoom = otherOwner['UIMain_Aisle'].connectRoom;\r\n        let otherDir = otherName.substring(0, 1);\r\n        let selfDir = this.moveDirection.substring(0, 1);\r\n        if (otherDir === 'l' || otherDir === 'r') {\r\n            if (openSwitch === false) {\r\n                let lrAisle = this.belongRoom.getChildByName(otherOwner.name);\r\n                if (otherOwner === lrAisle) {\r\n                    this.changeDirection();\r\n                }\r\n            }\r\n            else {\r\n                if (otherDir === selfDir) {\r\n                    if (this.belongRoom !== connectRoom) {\r\n                        this.belongRoom = connectRoom;\r\n                        this._belongChange = true;\r\n                        this.beforeInAirDir = this.moveDirection;\r\n                        this.personState = lwg.Enum.MoveState.inAir;\r\n                    }\r\n                }\r\n                else {\r\n                }\r\n            }\r\n        }\r\n        else if (otherDir === 'd' || otherDir === 'u') {\r\n            if (otherDir === 'd') {\r\n                if (openSwitch === false) {\r\n                }\r\n                else {\r\n                    if (selfDir === 'l' || selfDir === 'r') {\r\n                        if (this.belongRoom !== connectRoom) {\r\n                            this.belongRoom = connectRoom;\r\n                            this._belongChange = true;\r\n                            this.beforeInAirDir = this.moveDirection;\r\n                            this.personState = lwg.Enum.MoveState.inAir;\r\n                            this.moveDirection = lwg.Enum.PersonDir.down;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else if (otherDir === 'u') {\r\n                if (openSwitch === false) {\r\n                    let upAisle = this.belongRoom.getChildByName(otherOwner.name);\r\n                    if (otherOwner === upAisle) {\r\n                        this.changeDirection();\r\n                    }\r\n                }\r\n                else {\r\n                    if (otherDir === selfDir) {\r\n                        if (this.belongRoom !== connectRoom) {\r\n                            this.belongRoom = connectRoom;\r\n                            this._belongChange = true;\r\n                            this.beforeInAirDir = this.beforeLadderDir;\r\n                            this.personState = lwg.Enum.MoveState.inAir;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    onTriggerExit(other, self) {\r\n        if (!lwg.Global._gameStart) {\r\n            return;\r\n        }\r\n        if (other.label === 'floor') {\r\n            let belongName = other.owner.name.substring(other.owner.name.length - 5, other.owner.name.length);\r\n            if (this.belongRoom.name === belongName) {\r\n                if (this.personState !== lwg.Enum.MoveState.onLadder) {\r\n                    this.beforeInAirDir = this.moveDirection;\r\n                    this.personState = lwg.Enum.MoveState.inAir;\r\n                    this.moveDirection = lwg.Enum.PersonDir.down;\r\n                }\r\n            }\r\n        }\r\n        else if (other.label === 'ladder') {\r\n            let belongName = other.owner.name.substring(other.owner.name.length - 5, other.owner.name.length);\r\n            if (this.belongRoom.name === belongName) {\r\n                if (this.personState === lwg.Enum.MoveState.onFloor) {\r\n                    this.moveDirection = this.beforeFloorDir;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    changeDirection() {\r\n        if (this.moveDirection === lwg.Enum.PersonDir.left) {\r\n            this.moveDirection = lwg.Enum.PersonDir.right;\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.right) {\r\n            this.moveDirection = lwg.Enum.PersonDir.left;\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.up) {\r\n            this.moveDirection = lwg.Enum.PersonDir.down;\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.down) {\r\n            this.moveDirection = lwg.Enum.PersonDir.up;\r\n        }\r\n    }\r\n    move() {\r\n        if (this.attackSwitch) {\r\n            this.rig.setVelocity({ x: 0, y: 0 });\r\n            return;\r\n        }\r\n        if (this.moveDirection === lwg.Enum.PersonDir.left) {\r\n            this.rig.setVelocity({ x: -this.speed, y: 0 });\r\n            this.skeleton.scaleX = -1;\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.right) {\r\n            this.rig.setVelocity({ x: this.speed, y: 0 });\r\n            this.skeleton.scaleX = 1;\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.up) {\r\n            this.rig.setVelocity({ x: 0, y: -6 });\r\n        }\r\n        else if (this.moveDirection === lwg.Enum.PersonDir.down) {\r\n            this.rig.setVelocity({ x: 0, y: 6 });\r\n        }\r\n    }\r\n    noMoveDirection() {\r\n        if (!this.moveDirection) {\r\n            if (this.belongRoom) {\r\n                if (this.self.x > this.belongRoom.x) {\r\n                    this.moveDirection = lwg.Enum.PersonDir.left;\r\n                }\r\n                else {\r\n                    this.moveDirection = lwg.Enum.PersonDir.right;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    positionOffset() {\r\n        if (this.belongRoom) {\r\n            switch (this.personState) {\r\n                case lwg.Enum.MoveState.onFloor:\r\n                    if (this.currentFloor) {\r\n                        let y = this.currentFloor.y + this.belongRoom.y - this.belongRoom.height / 2;\r\n                        this.self.y = y - 20;\r\n                        this.positionOffsetXY();\r\n                    }\r\n                    break;\r\n                case lwg.Enum.MoveState.onLadder:\r\n                    if (this.currentLadder) {\r\n                        let x = this.currentLadder.x + this.belongRoom.x - this.belongRoom.width / 2;\r\n                        this.self.x = x;\r\n                        this.positionOffsetXY();\r\n                    }\r\n                    break;\r\n                case lwg.Enum.MoveState.inAir:\r\n                    this.positionOffsetXY();\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n    positionOffsetXY() {\r\n        if (!this._belongY || !this._belongX) {\r\n            if (this.belongRoom) {\r\n                this._belongX = this.belongRoom.x;\r\n                this._belongY = this.belongRoom.y;\r\n            }\r\n        }\r\n        else {\r\n            if (this._belongChange) {\r\n                this._belongY = null;\r\n                this._belongChange = false;\r\n            }\r\n            else {\r\n                let x = this.belongRoom.x - this._belongX;\r\n                let y = this.belongRoom.y - this._belongY;\r\n                this.self.x = this.self.x + x;\r\n                this.self.y = this.self.y + y;\r\n                this._belongX = this.belongRoom.x;\r\n                this._belongY = this.belongRoom.y;\r\n            }\r\n        }\r\n    }\r\n    gameOverMove() {\r\n        if (this.targetP) {\r\n            this.positionOffsetXY();\r\n        }\r\n    }\r\n    scopeControl() {\r\n        if (this.belongRoom) {\r\n            if (this.self.x > this.belongRoom.x + this.belongRoom.width / 2 + 30) {\r\n                this.self.x = this.belongRoom.x + this.belongRoom.width / 2 + 30;\r\n            }\r\n            if (this.self.x < this.belongRoom.x - this.belongRoom.width / 2 - 30) {\r\n                this.self.x = this.belongRoom.x - this.belongRoom.width / 2 - 30;\r\n            }\r\n            if (this.self.y > this.belongRoom.y + this.belongRoom.height / 2 + 30) {\r\n                this.self.y = this.belongRoom.y + this.belongRoom.height / 2 + 30;\r\n            }\r\n            if (this.self.y < this.belongRoom.y - this.belongRoom.height / 2 - 30) {\r\n                this.self.y = this.belongRoom.y - this.belongRoom.height / 2 - 30;\r\n            }\r\n        }\r\n    }\r\n    onUpdate() {\r\n        if (!lwg.Global._gameStart) {\r\n            this.rig.setVelocity({ x: 0, y: 0 });\r\n            this.gameOverMove();\r\n            return;\r\n        }\r\n        this.noMoveDirection();\r\n        this.move();\r\n        this.positionOffset();\r\n        this.scopeControl();\r\n    }\r\n    onDisable() {\r\n    }\r\n}\r\n",
  "references": [
    "D:/Game/project/Riddle/Riddle1/TJ3Demo_Promo/src/script/Lwg_Template/lwg.ts"
  ]
}
