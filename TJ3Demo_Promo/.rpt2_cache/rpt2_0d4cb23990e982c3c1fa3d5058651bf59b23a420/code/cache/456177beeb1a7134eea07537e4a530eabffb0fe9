{
  "code": "import { lwg } from \"../Lwg_Template/lwg\";\r\nimport ADManager, { TaT } from \"../../TJ/Admanager\";\r\nexport default class UIPifu extends lwg.Admin.Scene {\r\n    constructor() {\r\n        super();\r\n        this.moveSwitch = false;\r\n        this.noHaveIndex = 0;\r\n    }\r\n    selfVars() {\r\n        ADManager.CloseBanner();\r\n        this.PifuList = this.self['PifuList'];\r\n        this.BtnBack = this.self['BtnBack'];\r\n        this.BtnBuy = this.self['BtnBuy'];\r\n        this.BtnSelect = this.self['BtnSelect'];\r\n        ADManager.TAPoint(TaT.BtnShow, 'gold_skin');\r\n        ADManager.TAPoint(TaT.BtnShow, 'choose_skin');\r\n        if (!lwg.Global._elect) {\r\n            this.self['P201'].visible = false;\r\n        }\r\n        this.background = this.self['background'];\r\n    }\r\n    lwgInit() {\r\n        lwg.Global.ExecutionNumNode.alpha = 0;\r\n        lwg.Global._stageClick = false;\r\n        if (lwg.Enum.PifuAllName[lwg.Global._currentPifu]) {\r\n            this.listFirstIndex = lwg.Enum.PifuAllName[lwg.Global._currentPifu];\r\n        }\r\n        else {\r\n            this.listFirstIndex = -1;\r\n        }\r\n        lwg.Global.notHavePifuSubXD();\r\n        this.createPifuList();\r\n        this.priceDisplay();\r\n    }\r\n    adaptive() {\r\n        this.self['TowBtn'].y = Laya.stage.height * 0.766;\r\n        this.self['PifuLogo'].y = Laya.stage.height * 0.160;\r\n        this.self['PifuName'].y = Laya.stage.height * 0.261;\r\n        this.self['MatchDot'].y = Laya.stage.height * 0.684;\r\n        this.self['background_01'].height = Laya.stage.height;\r\n        this.self['BtnBack'].y = Laya.stage.height * 0.883;\r\n        this.self['P201'].y = Laya.stage.height * 0.208;\r\n        this.PifuList.y = Laya.stage.height * 0.471;\r\n    }\r\n    priceDisplay() {\r\n        let price = 250 * lwg.Global._buyNum - 150;\r\n        let num = this.BtnBuy.getChildByName('Num');\r\n        num.text = 'x' + price.toString();\r\n    }\r\n    openAni() {\r\n    }\r\n    createPifuList() {\r\n        this.PifuList.hScrollBarSkin = \"\";\r\n        this.PifuList.selectHandler = new Laya.Handler(this, this.onSelect_List);\r\n        this.PifuList.renderHandler = new Laya.Handler(this, this.updateItem);\r\n        this.refreshListData(null);\r\n        this.matchDotStaly();\r\n        this.selectPifuStyle();\r\n        this.listOpenAni();\r\n    }\r\n    listOpenAni() {\r\n        if (0 <= this.listFirstIndex && this.listFirstIndex <= 4) {\r\n            this.PifuList.scrollTo(this.PifuList.length - 1);\r\n        }\r\n        else {\r\n            this.PifuList.scrollTo(0);\r\n        }\r\n        this.PifuList.tweenTo(this.listFirstIndex, 600);\r\n    }\r\n    refreshListData(func) {\r\n        var data = [];\r\n        for (var m = -1; m < 10; m++) {\r\n            if (m === -1 || m === 9) {\r\n                data.push({\r\n                    stance: true\r\n                });\r\n                continue;\r\n            }\r\n            let name = lwg.Global._allPifu[m];\r\n            let have = false;\r\n            for (let index = 0; index < lwg.Global._havePifu.length; index++) {\r\n                const element = lwg.Global._havePifu[index];\r\n                if (lwg.Global._allPifu[m] === lwg.Global._havePifu[index]) {\r\n                    have = true;\r\n                }\r\n            }\r\n            let pifuUrl;\r\n            if (have) {\r\n                pifuUrl = lwg.Enum.PifuSkin[m];\r\n            }\r\n            else {\r\n                pifuUrl = lwg.Enum.PifuSkin_No[m];\r\n            }\r\n            let selectWord;\r\n            if (lwg.Global._currentPifu === lwg.Enum.PifuAllName[m]) {\r\n                selectWord = true;\r\n            }\r\n            else {\r\n                selectWord = false;\r\n            }\r\n            let scale;\r\n            if (m === this.listFirstIndex) {\r\n                scale = 1;\r\n            }\r\n            else {\r\n                scale = 0.7;\r\n            }\r\n            data.push({\r\n                have,\r\n                pifuUrl,\r\n                selectWord,\r\n                scale\r\n            });\r\n        }\r\n        this.PifuList.array = data;\r\n        if (func !== null) {\r\n            func();\r\n        }\r\n    }\r\n    onSelect_List(index) {\r\n    }\r\n    updateItem(cell, index) {\r\n        let dataSource = cell.dataSource;\r\n        let pifuImg = cell.getChildByName('PifuImg');\r\n        let select = cell.getChildByName('Select');\r\n        pifuImg.skin = dataSource.pifuUrl;\r\n        cell.scale(dataSource.scale, dataSource.scale);\r\n    }\r\n    onStageMouseDown() {\r\n        this.firstX = Laya.MouseManager.instance.mouseX;\r\n        this.moveSwitch = true;\r\n    }\r\n    onStageMouseUp() {\r\n        let x = Laya.MouseManager.instance.mouseX;\r\n        if (!this.moveSwitch) {\r\n            return;\r\n        }\r\n        let diffX = x - this.firstX;\r\n        if (diffX > 80) {\r\n            this.listFirstIndex -= 1;\r\n            if (this.listFirstIndex < 0) {\r\n                this.listFirstIndex = 0;\r\n            }\r\n        }\r\n        else if (diffX < -80) {\r\n            this.listFirstIndex += 1;\r\n            if (this.listFirstIndex > 8) {\r\n                this.listFirstIndex = 8;\r\n            }\r\n        }\r\n        this.moveSwitch = false;\r\n        this.PifuList.tweenTo(this.listFirstIndex, 50, Laya.Handler.create(this, this.moveCompelet));\r\n    }\r\n    moveCompelet() {\r\n        this.refreshListData(null);\r\n        this.matchDotStaly();\r\n        this.whetherHaveThisPifu();\r\n        this.selectPifuStyle();\r\n    }\r\n    selectPifuStyle() {\r\n        let wordpic = this.BtnSelect.getChildByName('wordpic');\r\n        if (this.PifuList.array[this.listFirstIndex + 1].selectWord) {\r\n            wordpic.skin = 'UI_new/Pifu/word_scelet_02.png';\r\n            wordpic.x = 67;\r\n        }\r\n        else {\r\n            wordpic.skin = 'UI_new/Pifu/word_scelet_01.png';\r\n            wordpic.x = 87;\r\n        }\r\n    }\r\n    matchDotStaly() {\r\n        let MatchDot = this.self['MatchDot'];\r\n        console.log(this.listFirstIndex);\r\n        for (let index = 0; index < MatchDot.numChildren; index++) {\r\n            const element = MatchDot.getChildAt(index);\r\n            if (element.name === this.listFirstIndex.toString()) {\r\n                element.getChildAt(0)['visible'] = false;\r\n                element.getChildAt(1)['visible'] = true;\r\n            }\r\n            else {\r\n                element.getChildAt(1)['visible'] = false;\r\n                element.getChildAt(0)['visible'] = true;\r\n            }\r\n        }\r\n        let namePic = this.self['PifuName'].getChildByName('namePic');\r\n        namePic.skin = lwg.Enum.PifuNameSkin[this.listFirstIndex];\r\n        namePic.pivotX = namePic.width / 2;\r\n        namePic.x = this.self['PifuName'].width / 2;\r\n    }\r\n    whetherHaveThisPifu() {\r\n        let cell = this.PifuList.getCell(this.listFirstIndex + 1);\r\n        if (cell.dataSource.have) {\r\n            this.showSelect = true;\r\n            this.BtnSelect.skin = 'UI_new/Victory/green_btn.png';\r\n        }\r\n        else {\r\n            this.showSelect = false;\r\n            this.BtnSelect.skin = 'UI_new/Victory/rede_btn_01.png';\r\n        }\r\n    }\r\n    btnOnClick() {\r\n        lwg.Click.on('largen', null, this.BtnBack, this, null, null, this.btnBackUp, null);\r\n        lwg.Click.on('largen', null, this.BtnBuy, this, null, null, this.btnBuyUp, null);\r\n        lwg.Click.on('largen', null, this.BtnSelect, this, null, null, this.btnSelectUp, null);\r\n    }\r\n    btnBackUp(event) {\r\n        event.stopPropagation();\r\n        event.currentTarget.scale(1, 1);\r\n        this.self.close();\r\n        lwg.LocalStorage.addData();\r\n    }\r\n    btnBuyUp(event) {\r\n        ADManager.TAPoint(TaT.BtnClick, 'gold_skin');\r\n        event.currentTarget.scale(1, 1);\r\n        event.stopPropagation();\r\n        let price = 250 * lwg.Global._buyNum - 150;\r\n        if (lwg.Global._goldNum < price || lwg.Global._notHavePifuSubXD.length <= 0) {\r\n            if (lwg.Global._goldNum < price) {\r\n                lwg.Global._createHint_01(lwg.Enum.HintType.noGold);\r\n            }\r\n            else if (lwg.Global._notHavePifuSubXD.length <= 0) {\r\n                lwg.Global._createHint_01(lwg.Enum.HintType.noGetPifu);\r\n            }\r\n            return;\r\n        }\r\n        else {\r\n            lwg.Global._goldNum -= price;\r\n            let Num = lwg.Global.GoldNumNode.getChildByName('Num');\r\n            Num.value = lwg.Global._goldNum.toString();\r\n            lwg.Global._buyNum++;\r\n            let random = Math.floor(Math.random() * lwg.Global._notHavePifuSubXD.length);\r\n            this.buyIndex = lwg.Enum.PifuAllName[lwg.Global._notHavePifuSubXD[random]];\r\n            console.log('购买了第' + this.buyIndex + '位置的皮肤');\r\n            this.nohavePifuAni();\r\n        }\r\n    }\r\n    nohavePifuAni() {\r\n        let noHavePifu_00 = lwg.Global._notHavePifuSubXD[this.noHaveIndex];\r\n        console.log(noHavePifu_00);\r\n        let index;\r\n        if (noHavePifu_00) {\r\n            index = lwg.Enum.PifuAllName[noHavePifu_00];\r\n            this.listFirstIndex = index;\r\n            this.refreshListData(null);\r\n            this.PifuList.tweenTo(index, 200, Laya.Handler.create(this, function () {\r\n                this.noHaveIndex++;\r\n                this.nohavePifuAni();\r\n            }));\r\n        }\r\n        else {\r\n            console.log('循环完毕，准备循环到被购买的那个皮肤', this.buyIndex);\r\n            this.PifuList.tweenTo(this.buyIndex, (11 - this.buyIndex) * 100, Laya.Handler.create(this, function () {\r\n                this.noHaveIndex = 0;\r\n                this.listFirstIndex = this.buyIndex;\r\n                this.buyCompelet();\r\n            }));\r\n        }\r\n    }\r\n    buyCompelet() {\r\n        lwg.Global._havePifu.push(lwg.Enum.PifuAllName[this.buyIndex]);\r\n        lwg.Global.notHavePifuSubXD();\r\n        this.refreshListData(f => {\r\n            this.priceDisplay();\r\n            this.selectPifuStyle();\r\n            this.matchDotStaly();\r\n            lwg.LocalStorage.addData();\r\n        });\r\n        console.log('购买完成！');\r\n    }\r\n    btnSelectUp(event) {\r\n        ADManager.TAPoint(TaT.BtnClick, 'choose_skin');\r\n        event.stopPropagation();\r\n        event.currentTarget.scale(1, 1);\r\n        this.whetherHaveThisPifu();\r\n        if (this.showSelect) {\r\n            lwg.Global._currentPifu = lwg.Global._allPifu[this.listFirstIndex];\r\n            this.refreshListData(null);\r\n            this.selectPifuStyle();\r\n        }\r\n    }\r\n    lwgDisable() {\r\n        lwg.LocalStorage.addData();\r\n        lwg.Global._stageClick = true;\r\n        lwg.Global.ExecutionNumNode.alpha = 1;\r\n        ADManager.ShowBanner();\r\n    }\r\n}\r\n",
  "references": [
    "D:/Game/project/Riddle/Riddle1/TJ3Demo_Promo/src/script/Lwg_Template/lwg.ts",
    "D:/Game/project/Riddle/Riddle1/TJ3Demo_Promo/src/TJ/Admanager.ts"
  ]
}
