{
  "code": "import { lwg } from \"../Lwg_Template/lwg\";\r\nexport default class UIPifu extends Laya.Script {\r\n    constructor() {\r\n        super();\r\n        this.moveSwitch = false;\r\n        this.currentIndex = 0;\r\n    }\r\n    onEnable() {\r\n        this.self = this.owner;\r\n        this.BtnBack = this.self['BtnBack'];\r\n        this.BtnBuy = this.self['BtnBuy'];\r\n        this.BtnSelect = this.self['BtnSelect'];\r\n        this.PifuParent = this.self['PifuParent'];\r\n        this.PifuList = this.self['PifuList'];\r\n        this.btnClickOn();\r\n        this.createPifuList();\r\n        this.noHave();\r\n    }\r\n    noHave() {\r\n        let allArray = [];\r\n        for (let i = 0; i < lwg.Global._orderPifu.length; i++) {\r\n            const element = lwg.Global._orderPifu[i];\r\n            allArray.push(element);\r\n        }\r\n        for (let j = 0; j < allArray.length; j++) {\r\n            let element1 = allArray[j];\r\n            for (let k = 0; k < lwg.Global._havePifu.length; k++) {\r\n                let element2 = lwg.Global._havePifu[k];\r\n                if (element1 === element2) {\r\n                    allArray.splice(j, 1);\r\n                    j--;\r\n                }\r\n            }\r\n        }\r\n        lwg.Global._notHavePifu = allArray;\r\n    }\r\n    createPifuList() {\r\n        this.PifuList.selectEnable = true;\r\n        this.PifuList.renderHandler = new Laya.Handler(this, this.updateItem);\r\n        this.PifuList.selectHandler = new Laya.Handler(this, this.onSelect_List);\r\n        var data = [];\r\n        for (var m = 0; m < 9; m++) {\r\n            data.push({\r\n                url: lwg.Enum.PifuSkin[m],\r\n                url_h: lwg.Enum.PifuSkin_h[m],\r\n                order: m,\r\n                scelet: true,\r\n                scale: 0.8\r\n            });\r\n        }\r\n        this.PifuList.array = data;\r\n    }\r\n    onSelect_List(index) {\r\n        console.log(\"当前选择的索引：\" + index);\r\n    }\r\n    onStageMouseDown() {\r\n        this.firstX = Laya.MouseManager.instance.mouseX;\r\n        this.moveSwitch = true;\r\n    }\r\n    onStageMouseUp() {\r\n        let x = Laya.MouseManager.instance.mouseX;\r\n        if (!this.moveSwitch) {\r\n            return;\r\n        }\r\n        let diffX = x - this.firstX;\r\n        if (diffX > 100) {\r\n            console.log('向左滑动');\r\n            this.currentIndex -= 1;\r\n        }\r\n        else if (diffX < -100) {\r\n            console.log('向右滑动');\r\n            this.currentIndex += 1;\r\n        }\r\n        this.currentIndex = this.currentIndex < 0 ? 0 : this.currentIndex;\r\n        this.PifuList.tweenTo(this.currentIndex, 300);\r\n        this.moveSwitch = false;\r\n    }\r\n    resetPifuList() {\r\n        let data;\r\n        for (var m = 0; m < 9; m++) {\r\n            data.push({\r\n                url: lwg.Enum.PifuSkin[m],\r\n                url_h: lwg.Enum.PifuSkin_h[m],\r\n                order: m,\r\n                scelet: true,\r\n                scale: 0.8,\r\n            });\r\n        }\r\n    }\r\n    updateItem(cell, index) {\r\n        cell.name = ('item' + index).toString();\r\n        let pifuImg = cell.getChildByName('PifuImg');\r\n        let select = cell.getChildByName('Select');\r\n        let lock = cell.getChildByName('Lock');\r\n        let have = false;\r\n        for (let i = 0; i < lwg.Global._havePifu.length; i++) {\r\n            if (lwg.Enum.PifuOrder[index] === lwg.Global._havePifu[i]) {\r\n                have = true;\r\n            }\r\n        }\r\n        if (have) {\r\n            pifuImg.skin = this.PifuList.array[index].url;\r\n            lock.visible = false;\r\n        }\r\n        else {\r\n            pifuImg.skin = this.PifuList.array[index].url_h;\r\n            lock.visible = true;\r\n        }\r\n        if (lwg.Global._currentPifu === lwg.Enum.PifuOrder[index]) {\r\n            select.visible = true;\r\n        }\r\n        else {\r\n            select.visible = false;\r\n        }\r\n        if (index === this.currentIndex + 1) {\r\n            cell.scale(1, 1);\r\n        }\r\n        else {\r\n            cell.scale(0.85, 0.85);\r\n        }\r\n        if (index === this.currentIndex + 1) {\r\n            if (!lock.visible) {\r\n                this.BtnSelect.skin = 'pifu/select_btn1.png';\r\n            }\r\n            else {\r\n                this.BtnSelect.skin = 'pifu/select_btn2.png';\r\n            }\r\n        }\r\n    }\r\n    btnClickOn() {\r\n        lwg.Click.on('largen', null, this.BtnBack, this, null, null, this.btnBackClickUP, null);\r\n        lwg.Click.on('largen', null, this.BtnBuy, this, null, null, this.btnBuyClickUP, null);\r\n        lwg.Click.on('largen', null, this.BtnSelect, this, null, null, this.btnSelectClickUP, null);\r\n    }\r\n    btnBackClickUP(event) {\r\n        event.currentTarget.scale(1, 1);\r\n        this.self.close();\r\n    }\r\n    btnBuyClickUP(event) {\r\n        event.currentTarget.scale(1, 1);\r\n        let random = Math.floor(Math.random() * lwg.Global._notHavePifu.length);\r\n        let pifuIndex = lwg.Enum.PifuOrder[lwg.Global._notHavePifu[random]];\r\n        this.PifuList.tweenTo(pifuIndex, 300, Laya.Handler.create(this, function () {\r\n        }));\r\n    }\r\n    btnSelectClickUP(event) {\r\n        event.currentTarget.scale(1, 1);\r\n        let cell = this.PifuList.getCell(this.currentIndex + 1);\r\n        let select = cell.getChildByName('Select');\r\n        let lock = cell.getChildByName('Lock');\r\n        if (!lock.visible) {\r\n            console.log('可以选择！');\r\n            select.visible = true;\r\n            let number = lwg.Enum.PifuOrder[lwg.Global._currentPifu];\r\n            let cell1 = this.PifuList.getCell(number);\r\n            let select1 = cell.getChildByName('Select');\r\n            select1.visible = false;\r\n            lwg.Global._currentPifu = lwg.Enum.PifuOrder[this.currentIndex + 1];\r\n        }\r\n    }\r\n    onDisable() {\r\n    }\r\n}\r\n",
  "references": [
    "D:/Game/project/Riddle/Riddle1/TJ3Demo_Promo/src/script/Lwg_Template/lwg.ts"
  ]
}
